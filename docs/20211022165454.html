<!DOCTYPE html><!--XcW8xoQAKlCXMZtt_Fu59--><html lang="ja"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/chunks/5cd79379acc82b6b.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/b21aca2c9ac15a8a.js"/><script src="/_next/static/chunks/a9077698ef76e11f.js" async=""></script><script src="/_next/static/chunks/9111b5fcf0c978a5.js" async=""></script><script src="/_next/static/chunks/7e6ac27ac20c5ced.js" async=""></script><script src="/_next/static/chunks/turbopack-50d90477f30c1568.js" async=""></script><script src="/_next/static/chunks/1af1dd91bd03bb80.js" async=""></script><script src="/_next/static/chunks/cc5639b053815f24.js" async=""></script><script src="/_next/static/chunks/4904848246fadb45.js" async=""></script><title>MyDocs</title><meta name="description" content="A simple SSG blog built with Next.js"/><script src="/_next/static/chunks/a6dad97d9634a72d.js" noModule=""></script></head><body style="background-color:ghostwhite;margin:0;min-height:100vh"><div hidden=""><!--$--><!--/$--></div><header style="padding:1rem 0;margin-bottom:0.25rem"><div style="max-width:1000px;margin:0 auto;padding:0 2rem"><a style="font-size:1.5rem;font-weight:bold;text-decoration:none;color:#333" href="/">MyDocs</a></div></header><article style="max-width:1000px;margin:0 auto;padding:0 2rem 2rem"><h1>prisma-client-goを試した</h1><div><h2>prisma のセットアップ</h2>
<p>まずは project の作成から。</p>
<pre><code class="hljs language-bash">$ go mod init backend
</code></pre>
<p>client のインストール。</p>
<pre><code class="hljs language-bash">$ go get github.com/prisma/prisma-client-go
</code></pre>
<p>スキーマの作成。</p>
<pre><code class="hljs language-bash">$ npx prisma init
</code></pre>
<p><code>prisma/schema.prisma</code> と <code>.env</code> (と .gitignore ) が生成される。</p>
<p><code>.env</code> ファイルは <code>DATABASE_URL</code> を修正。</p>
<pre><code class="hljs language-env"># Environment variables declared in this file are automatically made available to Prisma.
# See the documentation for more detail: https://pris.ly/d/prisma-schema#using-environment-variables

# Prisma supports the native connection string format for PostgreSQL, MySQL, SQLite, SQL Server and MongoDB (Preview).
# See the documentation for all the connection string options: https://pris.ly/d/connection-strings

DATABASE_URL="mysql://app:password@localhost:3306/app"
</code></pre>
<p><code>prisma/schema.prisma</code> は <code>client</code> を <code>prisma-client-go</code> に、 <code>datasource</code> を <code>mysql</code> に修正。</p>
<pre><code class="hljs language-schema.prisma">// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "go run github.com/prisma/prisma-client-go"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}
</code></pre>
<p><code>Task</code> モデルを定義する。</p>
<pre><code class="hljs language-schema.prisma">// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "go run github.com/prisma/prisma-client-go"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Task {
  id String @default(cuid()) @id
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  title String
  status Boolean
  desc String?
}
</code></pre>
<p>prisma クライアントの作成.
<code>prisma/db/</code> が生成される。</p>
<pre><code class="hljs language-bash">$ go run github.com/prisma/prisma-client-go generate
</code></pre>
<p>DB にスキーマを反映させる。</p>
<pre><code class="hljs language-bash">$ go run github.com/prisma/prisma-client-go migrate dev --name create_task

~~
~~
migrations/
  └─ 20211022082219_create_task/
    └─ migration.sql

Your database is now <span class="hljs-keyword">in</span> <span class="hljs-built_in">sync</span> with your schema.
</code></pre>
<p>既にスキーマファイルが存在する場合。</p>
<pre><code class="hljs language-bash">go run github.com/prisma/prisma-client-go migrate dev
</code></pre>
<p><code>prisma/migrations/20211022082219_create_task/migration.sql</code> を見てみる。</p>
<pre><code class="hljs language-sql"><span class="hljs-comment">-- CreateTable</span>
<span class="hljs-keyword">CREATE TABLE</span> `Task` (
    `id` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">191</span>) <span class="hljs-keyword">NOT NULL</span>,
    `createdAt` DATETIME(<span class="hljs-number">3</span>) <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>(<span class="hljs-number">3</span>),
    `updatedAt` DATETIME(<span class="hljs-number">3</span>) <span class="hljs-keyword">NOT NULL</span>,
    `title` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">191</span>) <span class="hljs-keyword">NOT NULL</span>,
    `status` <span class="hljs-type">BOOLEAN</span> <span class="hljs-keyword">NOT NULL</span>,
    `<span class="hljs-keyword">desc</span>` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">191</span>) <span class="hljs-keyword">NULL</span>,

    <span class="hljs-keyword">PRIMARY KEY</span> (`id`)
) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CHARACTER SET</span> utf8mb4 <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci;
</code></pre>
<p>テーブルも作成されている。</p>
<pre><code class="hljs language-mysql">mysql> show tables;
+--------------------+
| Tables_in_app      |
+--------------------+
| _prisma_migrations |
| Task               |
+--------------------+
</code></pre>
<p><code>Comment</code> モデルを定義し、 <code>Task</code> モデルと関連付けを行う。</p>
<pre><code class="hljs language-schema.prisma">model Task {
  id String @default(cuid()) @id
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  title String
  status Boolean
  desc String?

  comments Comment[]
}

model Comment {
  id String @default(cuid()) @id
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  content String

  task Task @relation(fields: [taskId], references: [id])
  taskId String
</code></pre>
<p>migration を行う。</p>
<pre><code class="hljs language-bash">$ go run github.com/prisma/prisma-client-go migrate dev --name add_comment_model

~~
~~
migrations/
  └─ 20211022083117_add_comment_model/
    └─ migration.sql

Your database is now <span class="hljs-keyword">in</span> <span class="hljs-built_in">sync</span> with your schema.
</code></pre>
<p><code>migrations/20211022083117_add_comment_model/migration.sql</code> を見る。</p>
<pre><code class="hljs language-sql"><span class="hljs-comment">-- CreateTable</span>
<span class="hljs-keyword">CREATE TABLE</span> `Comment` (
    `id` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">191</span>) <span class="hljs-keyword">NOT NULL</span>,
    `createdAt` DATETIME(<span class="hljs-number">3</span>) <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>(<span class="hljs-number">3</span>),
    `updatedAt` DATETIME(<span class="hljs-number">3</span>) <span class="hljs-keyword">NOT NULL</span>,
    `content` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">191</span>) <span class="hljs-keyword">NOT NULL</span>,
    `taskId` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">191</span>) <span class="hljs-keyword">NOT NULL</span>,

    <span class="hljs-keyword">PRIMARY KEY</span> (`id`)
) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CHARACTER SET</span> utf8mb4 <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci;

<span class="hljs-comment">-- AddForeignKey</span>
<span class="hljs-keyword">ALTER TABLE</span> `Comment` <span class="hljs-keyword">ADD CONSTRAINT</span> `Comment_taskId_fkey` <span class="hljs-keyword">FOREIGN KEY</span> (`taskId`) <span class="hljs-keyword">REFERENCES</span> `Task`(`id`) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> RESTRICT <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> CASCADE;
</code></pre>
<h2>Prisma Studio を使う</h2>
<p><code>localhost:5555</code> で起動する。</p>
<pre><code class="hljs language-bash">$ npx prisma studio
</code></pre>
<h2>prisma api syntax</h2>
<h3>全件取得する</h3>
<pre><code class="hljs language-go">tasks, err := client.Task.FindMany().Exec(context.Background())
</code></pre>
<h3>クエリで取得する</h3>
<pre><code class="hljs language-go">tasks, err := client.Task.FindMany(
  db.Task.Title.Equals(<span class="hljs-string">"1st task"</span>)
  <span class="hljs-comment">// &#x3C;model>.&#x3C;field>.&#x3C;method>.(value) 基本的にこの形式で使う</span>
).Exec(context.Background())
</code></pre>
<h3>一意なデータを取得する</h3>
<p><code>schema.prisma</code> で <code>@id</code> 、 <code>@unique</code> でマークされたもののみに使用可能。</p>
<pre><code class="hljs language-go">task, err := client.Task.FindUnique(
  db.Task.ID.Equals(<span class="hljs-string">"1234567890"</span>)
).Exec(context.Background())
</code></pre>
<h3>最初に見つかった 1 件を取得する</h3>
<pre><code class="hljs language-go">task, err := client.Task.FindFirst(
  db.Task.Title.Equals(<span class="hljs-string">"1st task"</span>)
).Exec(context.Background())
</code></pre>
<h3>スキーマのデータ型によってよしなにできる</h3>
<ul>
<li><code>String Filter</code></li>
</ul>
<pre><code class="hljs language-go">tasks, err := client.Task.FindMany(
  <span class="hljs-comment">// Title が "1st task" と一致する Task を取得</span>
  db.Task.Title.Equals(<span class="hljs-string">"1st task"</span>)

  <span class="hljs-comment">// Title に "task" を含む Task を取得</span>
  <span class="hljs-comment">// db.Task.Title.Contains("task")</span>

  <span class="hljs-comment">// Title が "1st" から始まる Task を取得</span>
  <span class="hljs-comment">// db.Task.Title.StartsWith("1st")</span>

  <span class="hljs-comment">// Title が "task" で終わる Task を取得</span>
  <span class="hljs-comment">// db.Task.Title.EndsWith("task")</span>
).Exec(context.Background())
</code></pre>
<ul>
<li><code>Number Filter</code></li>
</ul>
<pre><code class="hljs language-go"><span class="hljs-comment">// &#x3C;Field> が 50 である &#x3C;Model> を取得</span>
db.&#x3C;Model>.&#x3C;Field>.Equals(<span class="hljs-number">50</span>).Exec(context.Background())

<span class="hljs-comment">// &#x3C;Field> が 50 以下の &#x3C;Model> を取得</span>
db.&#x3C;Model>.&#x3C;Field>.Lte(<span class="hljs-number">50</span>).Exec(context.Background())

<span class="hljs-comment">// &#x3C;Field> が 50 未満の &#x3C;Model> を取得</span>
db.&#x3C;Model>.&#x3C;Field>.Lt(<span class="hljs-number">50</span>).Exec(context.Background())

<span class="hljs-comment">// &#x3C;Field> が 50 以上の &#x3C;Model> を取得</span>
db.&#x3C;Model>.&#x3C;Field>.Gte(<span class="hljs-number">50</span>).Exec(context.Background())

<span class="hljs-comment">// &#x3C;Field> が 50 より大きいの &#x3C;Model> を取得</span>
db.&#x3C;Model>.&#x3C;Field>.Gte(<span class="hljs-number">50</span>).Exec(context.Background())
</code></pre>
<ul>
<li><code>Time Filter</code></li>
</ul>
<pre><code class="hljs language-go">tasks, err := client.Task.FindMany(
  <span class="hljs-comment">// 昨日作成された task を取得する</span>
  db.Task.CreatedAt.Equals(yesterday)

  <span class="hljs-comment">// 過去 6 時間で作られた task を取得する (createdAt > 6 hours ago)</span>
  <span class="hljs-comment">// db.Task.Gt(time.Now().Add(-6 * time.Hour))</span>

  <span class="hljs-comment">// 過去 6 時間で作られた task を取得する (createdAt >= 6 hours ago)</span>
  <span class="hljs-comment">// db.Task.Gte(time.Now().Add(-6 * time.Hour))</span>

  <span class="hljs-comment">// 昨日作成された task を取得する</span>
  <span class="hljs-comment">// db.Task.Lt(time.Now().Truncate(24 * time.Hour))</span>

  <span class="hljs-comment">// 昨日作成された task を取得する (本日 00:00:00 を含む)</span>
  <span class="hljs-comment">// db.Task.Lte(time.Now().Truncate(24 * time.Hour))</span>
).Exec(context.Background())
</code></pre>
<h3>NULL 関連</h3>
<p>null であるものを取得する。</p>
<pre><code class="hljs language-go">db.Task.Content.EqualsOptional(<span class="hljs-literal">nil</span>).Exec(context.Background())

content := <span class="hljs-string">"string"</span>
db.Task.Content.EqualsOptional(&#x26;content).Exec(context.Background())
</code></pre>
<h3>他にも</h3>
<ul>
<li><code>Not</code></li>
</ul>
<pre><code class="hljs language-go">db.Task.Not(
  db.Task.Title.Equals(<span class="hljs-string">"1st task"</span>)
).Exec(context.Background())
</code></pre>
<ul>
<li><code>Or</code></li>
</ul>
<pre><code class="hljs language-go">db.Task.Or(
  db.Task.Title.Equals(<span class="hljs-string">"1st task"</span>),
  db.Task.Desc.Equals(<span class="hljs-string">"new task"</span>)
).Exec(context.Background())
</code></pre>
<h3>関連付けされたクエリ</h3>
<p>task の title が "1st task" で comment が "new content" であるもの task を取得する。</p>
<pre><code class="hljs language-go">tasks, err := client.Task.FindMany(
  db.Task.Title.Equals(<span class="hljs-string">"1st task"</span>)
  db.Task.Comments.Some(
    db.Comment.Content.Equals(<span class="hljs-string">"new content"</span>),
  ),
).Exec(context.Background())
</code></pre>
<h3>create</h3>
<pre><code class="hljs language-go">created, err := client.Task.CreateOne(
  db.Task.Title.Set(newTask.Title),
  db.Task.Status.Set(newTask.Status),
  db.Task.Desc.Set(newTask.Desc),
).Exec(context.Background())
</code></pre>
<p>関連付けのあるデータの場合。</p>
<pre><code class="hljs language-go">created, err := client.Comment.CreateOne(
  db.Comment.Content.Set(newComment.Content),
  db.Comment.Task.Link(
    db.Task.ID.Equals(taskId),
  ),
).Exec(context.Background())
</code></pre>
<h3>update</h3>
<pre><code class="hljs language-go">updated, err := client.Task.FindUnique(
  db.Task.ID.Equals(taskId),
).Update(
  db.Task.Title.Set(newTask.Title),
  db.Task.Status.Set(newTask.Status),
  db.Task.Desc.Set(newTask.Desc),
).Exec(context.Background())
</code></pre>
<h3>delete</h3>
<pre><code class="hljs language-go">_, err := client.Task.FindUnique(
  db.Task.ID.Equals(taskId),
).Delete().Exec(context.Background())
</code></pre>
<h3>ソースコード全体</h3>
<p>今回は <code>github.com/gorilla/mux</code> を使って API サーバを作った。</p>
<pre><code class="hljs language-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"backend/prisma/db"</span>
	<span class="hljs-string">"context"</span>
	<span class="hljs-string">"encoding/json"</span>
	<span class="hljs-string">"io"</span>
	<span class="hljs-string">"net/http"</span>

	<span class="hljs-string">"github.com/gorilla/mux"</span>
)

<span class="hljs-keyword">type</span> Task <span class="hljs-keyword">struct</span> {
	Id        <span class="hljs-type">string</span> <span class="hljs-string">`json:"id"`</span>
	CreatedAt <span class="hljs-type">string</span> <span class="hljs-string">`json:"created_at"`</span>
	UpdatedAt <span class="hljs-type">string</span> <span class="hljs-string">`json:"updated_at"`</span>
	Title     <span class="hljs-type">string</span> <span class="hljs-string">`json:"title"`</span>
	Status    <span class="hljs-type">bool</span>   <span class="hljs-string">`json:"status"`</span>
	Desc      <span class="hljs-type">string</span> <span class="hljs-string">`json:"string"`</span>
}
<span class="hljs-keyword">type</span> Comment <span class="hljs-keyword">struct</span> {
	Id        <span class="hljs-type">string</span> <span class="hljs-string">`json:"id"`</span>
	CreatedAt <span class="hljs-type">string</span> <span class="hljs-string">`json:"created_at"`</span>
	UpdatedAt <span class="hljs-type">string</span> <span class="hljs-string">`json:"updated_at"`</span>
	Content   <span class="hljs-type">string</span> <span class="hljs-string">`json:"content"`</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	client := db.NewClient()
	<span class="hljs-keyword">if</span> err := client.Prisma.Connect(); err != <span class="hljs-literal">nil</span> {
		<span class="hljs-built_in">panic</span>(err)
	}
	<span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
		<span class="hljs-keyword">if</span> err := client.Prisma.Disconnect(); err != <span class="hljs-literal">nil</span> {
			<span class="hljs-built_in">panic</span>(err)
		}
	}()

	router := mux.NewRouter()

	router.HandleFunc(<span class="hljs-string">"/tasks"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
		<span class="hljs-keyword">var</span> newTask Task
		err := r.ParseForm()
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			io.WriteString(w, <span class="hljs-string">"ERROR: create task"</span>)
		}
		json.NewDecoder(r.Body).Decode(&#x26;newTask)

		created, err := client.Task.CreateOne(
			db.Task.Title.Set(newTask.Title),
			db.Task.Status.Set(newTask.Status),
			db.Task.Desc.Set(newTask.Desc),
		).Exec(context.Background())
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			io.WriteString(w, <span class="hljs-string">"ERROR: create task"</span>)
		}

		<span class="hljs-keyword">var</span> response <span class="hljs-keyword">struct</span> {
			Code <span class="hljs-type">int</span>    <span class="hljs-string">`json:"code"`</span>
			Data []Task <span class="hljs-string">`json:"data"`</span>
		}
		response.Code = <span class="hljs-number">200</span>
		response.Data = <span class="hljs-built_in">append</span>(response.Data, Task{
			Id:        created.ID,
			CreatedAt: created.CreatedAt.String(),
			UpdatedAt: created.UpdatedAt.String(),
			Title:     created.Title,
			Status:    created.Status,
			Desc: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-type">string</span> {
				desc, ok := created.Desc()
				<span class="hljs-keyword">if</span> !ok {
					desc = <span class="hljs-string">""</span>
				}
				<span class="hljs-keyword">return</span> desc
			}(),
		})
		resp, _ := json.Marshal(response)
		w.Header().Set(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>)
		w.Write(resp)
	}).Methods(<span class="hljs-string">"POST"</span>)

	router.HandleFunc(<span class="hljs-string">"/tasks/{task_id}"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
		params := mux.Vars(r)
		taskId := params[<span class="hljs-string">"task_id"</span>]

		task, err := client.Task.FindUnique(
			db.Task.ID.Equals(taskId),
		).Exec(context.Background())
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			io.WriteString(w, <span class="hljs-string">"ERROR: read task"</span>)
		}

		<span class="hljs-keyword">var</span> response <span class="hljs-keyword">struct</span> {
			Code <span class="hljs-type">int</span>    <span class="hljs-string">`json:"code"`</span>
			Data []Task <span class="hljs-string">`json:"data"`</span>
		}
		response.Code = <span class="hljs-number">200</span>
		response.Data = <span class="hljs-built_in">append</span>(response.Data, Task{
			Id:        task.ID,
			CreatedAt: task.CreatedAt.String(),
			UpdatedAt: task.UpdatedAt.String(),
			Title:     task.Title,
			Status:    task.Status,
			Desc: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-type">string</span> {
				desc, ok := task.Desc()
				<span class="hljs-keyword">if</span> !ok {
					desc = <span class="hljs-string">""</span>
				}
				<span class="hljs-keyword">return</span> desc
			}(),
		})
		resp, _ := json.Marshal(response)
		w.Header().Set(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>)
		w.Write(resp)
	}).Methods(<span class="hljs-string">"GET"</span>)

	router.HandleFunc(<span class="hljs-string">"/tasks/{task_id}"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
		params := mux.Vars(r)
		taskId := params[<span class="hljs-string">"task_id"</span>]
		<span class="hljs-keyword">var</span> newTask Task
		err := r.ParseForm()
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			io.WriteString(w, <span class="hljs-string">"ERROR: update task"</span>)
		}
		json.NewDecoder(r.Body).Decode(&#x26;newTask)

		updated, err := client.Task.FindUnique(
			db.Task.ID.Equals(taskId),
		).Update(
			db.Task.Title.Set(newTask.Title),
			db.Task.Status.Set(newTask.Status),
			db.Task.Desc.Set(newTask.Desc),
		).Exec(context.Background())
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			io.WriteString(w, <span class="hljs-string">"ERROR: update task"</span>)
		}
		<span class="hljs-keyword">var</span> response <span class="hljs-keyword">struct</span> {
			Code <span class="hljs-type">int</span>    <span class="hljs-string">`json:"code"`</span>
			Data []Task <span class="hljs-string">`json:"data"`</span>
		}
		response.Code = <span class="hljs-number">200</span>
		response.Data = <span class="hljs-built_in">append</span>(response.Data, Task{
			Id:        updated.ID,
			CreatedAt: updated.CreatedAt.String(),
			UpdatedAt: updated.UpdatedAt.String(),
			Title:     updated.Title,
			Status:    updated.Status,
			Desc: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-type">string</span> {
				desc, ok := updated.Desc()
				<span class="hljs-keyword">if</span> !ok {
					desc = <span class="hljs-string">""</span>
				}
				<span class="hljs-keyword">return</span> desc
			}(),
		})
		resp, _ := json.Marshal(response)
		w.Header().Set(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>)
		w.Write(resp)
	}).Methods(<span class="hljs-string">"POST"</span>)

	router.HandleFunc(<span class="hljs-string">"/tasks/{task_id}"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
		params := mux.Vars(r)
		taskId := params[<span class="hljs-string">"task_id"</span>]

		_, err := client.Task.FindUnique(
			db.Task.ID.Equals(taskId),
		).Delete().Exec(context.Background())
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			io.WriteString(w, <span class="hljs-string">"ERROR: delete task"</span>)
		}

		tasks, err := client.Task.FindMany().Exec(context.Background())
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			io.WriteString(w, <span class="hljs-string">"ERROR: read all task"</span>)
		}
		<span class="hljs-keyword">var</span> responseData []Task
		<span class="hljs-keyword">for</span> _, task := <span class="hljs-keyword">range</span> tasks {
			responseData = <span class="hljs-built_in">append</span>(responseData, Task{
				Id:        task.ID,
				CreatedAt: task.CreatedAt.String(),
				UpdatedAt: task.UpdatedAt.String(),
				Title:     task.Title,
				Status:    <span class="hljs-literal">false</span>,
				Desc: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-type">string</span> {
					desc, ok := task.Desc()
					<span class="hljs-keyword">if</span> !ok {
						desc = <span class="hljs-string">""</span>
					}
					<span class="hljs-keyword">return</span> desc
				}(),
			})
		}
		<span class="hljs-keyword">var</span> response <span class="hljs-keyword">struct</span> {
			Code <span class="hljs-type">int</span>    <span class="hljs-string">`json:"code"`</span>
			Data []Task <span class="hljs-string">`json:"data"`</span>
		}
		response.Code = <span class="hljs-number">200</span>
		response.Data = <span class="hljs-built_in">append</span>(response.Data, responseData...)
		resp, _ := json.Marshal(response)
		w.Header().Set(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>)
		w.Write(resp)
	}).Methods(<span class="hljs-string">"DELETE"</span>)

	router.HandleFunc(<span class="hljs-string">"/tasks"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
		tasks, err := client.Task.FindMany().Exec(context.Background())
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			io.WriteString(w, <span class="hljs-string">"ERROR: read all task"</span>)
		}
		<span class="hljs-keyword">var</span> responseData []Task
		<span class="hljs-keyword">for</span> _, task := <span class="hljs-keyword">range</span> tasks {
			responseData = <span class="hljs-built_in">append</span>(responseData, Task{
				Id:        task.ID,
				CreatedAt: task.CreatedAt.String(),
				UpdatedAt: task.UpdatedAt.String(),
				Title:     task.Title,
				Status:    <span class="hljs-literal">false</span>,
				Desc: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-type">string</span> {
					desc, ok := task.Desc()
					<span class="hljs-keyword">if</span> !ok {
						desc = <span class="hljs-string">""</span>
					}
					<span class="hljs-keyword">return</span> desc
				}(),
			})
		}
		<span class="hljs-keyword">var</span> response <span class="hljs-keyword">struct</span> {
			Code <span class="hljs-type">int</span>    <span class="hljs-string">`json:"code"`</span>
			Data []Task <span class="hljs-string">`json:"data"`</span>
		}
		response.Code = <span class="hljs-number">200</span>
		response.Data = <span class="hljs-built_in">append</span>(response.Data, responseData...)
		resp, _ := json.Marshal(response)
		w.Header().Set(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>)
		w.Write(resp)
	}).Methods(<span class="hljs-string">"GET"</span>)

	router.HandleFunc(<span class="hljs-string">"/tasks/{task_id}/comments"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
		params := mux.Vars(r)
		taskId := params[<span class="hljs-string">"task_id"</span>]
		<span class="hljs-keyword">var</span> newComment Comment
		err := r.ParseForm()
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			io.WriteString(w, <span class="hljs-string">"ERROR: create comment"</span>)
		}
		json.NewDecoder(r.Body).Decode(&#x26;newComment)

		created, err := client.Comment.CreateOne(
			db.Comment.Content.Set(newComment.Content),
			db.Comment.Task.Link(
				db.Task.ID.Equals(taskId),
			),
		).Exec(context.Background())
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			io.WriteString(w, <span class="hljs-string">"ERROR: create comment"</span>)
		}
		<span class="hljs-keyword">var</span> response <span class="hljs-keyword">struct</span> {
			Code <span class="hljs-type">int</span>       <span class="hljs-string">`json:"code"`</span>
			Data []Comment <span class="hljs-string">`json:"data"`</span>
		}
		response.Code = <span class="hljs-number">200</span>
		response.Data = <span class="hljs-built_in">append</span>(response.Data, Comment{
			Id:        created.ID,
			CreatedAt: created.CreatedAt.String(),
			UpdatedAt: created.UpdatedAt.String(),
			Content:   created.Content,
		})
		resp, _ := json.Marshal(response)
		w.Header().Set(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>)
		w.Write(resp)
	}).Methods(<span class="hljs-string">"POST"</span>)

	router.HandleFunc(<span class="hljs-string">"/tasks/{task_id}/comments"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
		params := mux.Vars(r)
		taskId := params[<span class="hljs-string">"task_id"</span>]
		comments, err := client.Comment.FindMany(
			db.Comment.TaskID.Equals(taskId),
		).Exec(context.Background())
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			io.WriteString(w, <span class="hljs-string">"ERROR: read comment"</span>)
		}
		<span class="hljs-keyword">var</span> responseData []Comment
		<span class="hljs-keyword">for</span> _, comment := <span class="hljs-keyword">range</span> comments {
			responseData = <span class="hljs-built_in">append</span>(responseData, Comment{
				Id:        comment.ID,
				CreatedAt: comment.CreatedAt.String(),
				UpdatedAt: comment.UpdatedAt.String(),
				Content:   comment.Content,
			})
		}
		<span class="hljs-keyword">var</span> response <span class="hljs-keyword">struct</span> {
			Code <span class="hljs-type">int</span>       <span class="hljs-string">`json:"code"`</span>
			Data []Comment <span class="hljs-string">`json:"data"`</span>
		}
		response.Code = <span class="hljs-number">200</span>
		response.Data = <span class="hljs-built_in">append</span>(response.Data, responseData...)
		resp, _ := json.Marshal(response)
		w.Header().Set(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>)
		w.Write(resp)
	}).Methods(<span class="hljs-string">"GET"</span>)

	router.HandleFunc(<span class="hljs-string">"/tasks/{task_id}/comments/{comment_id}"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
		params := mux.Vars(r)
		commentId := params[<span class="hljs-string">"comment_id"</span>]
		<span class="hljs-keyword">var</span> newComment Comment
		err := r.ParseForm()
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			io.WriteString(w, <span class="hljs-string">"ERROR: update comment"</span>)
		}
		json.NewDecoder(r.Body).Decode(&#x26;newComment)

		updated, err := client.Comment.FindUnique(
			db.Comment.ID.Equals(commentId),
		).Update(
			db.Comment.Content.Set(newComment.Content),
		).Exec(context.Background())
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			io.WriteString(w, <span class="hljs-string">"update error"</span>)
		}
		<span class="hljs-keyword">var</span> response <span class="hljs-keyword">struct</span> {
			Code <span class="hljs-type">int</span>       <span class="hljs-string">`json:"code"`</span>
			Data []Comment <span class="hljs-string">`json:"comment"`</span>
		}
		response.Code = <span class="hljs-number">200</span>
		response.Data = <span class="hljs-built_in">append</span>(response.Data, Comment{
			Id:        updated.ID,
			CreatedAt: updated.CreatedAt.String(),
			UpdatedAt: updated.UpdatedAt.String(),
			Content:   updated.Content,
		})
		resp, _ := json.Marshal(response)
		w.Header().Set(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>)
		w.Write(resp)
	}).Methods(<span class="hljs-string">"POST"</span>)

	router.HandleFunc(<span class="hljs-string">"/tasks/{task_id}/comments/{comment_id}"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
		params := mux.Vars(r)
		taskId := params[<span class="hljs-string">"task_id"</span>]
		commentId := params[<span class="hljs-string">"comment_id"</span>]

		_, err := client.Comment.FindUnique(
			db.Comment.ID.Equals(commentId),
		).Delete().Exec(context.Background())
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			io.WriteString(w, <span class="hljs-string">"ERROR: delete comment"</span>)
		}

		comments, err := client.Comment.FindMany(
			db.Comment.TaskID.Equals(taskId),
		).Exec(context.Background())
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			io.WriteString(w, <span class="hljs-string">"ERROR: read all comment"</span>)
		}
		<span class="hljs-keyword">var</span> responseData []Comment
		<span class="hljs-keyword">for</span> _, comment := <span class="hljs-keyword">range</span> comments {
			responseData = <span class="hljs-built_in">append</span>(responseData, Comment{
				Id:        comment.ID,
				CreatedAt: comment.CreatedAt.String(),
				UpdatedAt: comment.UpdatedAt.String(),
				Content:   comment.Content,
			})
		}
		<span class="hljs-keyword">var</span> response <span class="hljs-keyword">struct</span> {
			Code <span class="hljs-type">int</span>       <span class="hljs-string">`json:"code"`</span>
			Data []Comment <span class="hljs-string">`json:"data"`</span>
		}
		response.Code = <span class="hljs-number">200</span>
		response.Data = <span class="hljs-built_in">append</span>(response.Data, responseData...)
		resp, _ := json.Marshal(response)
		w.Header().Set(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>)
		w.Write(resp)
	}).Methods(<span class="hljs-string">"DELETE"</span>)

	server := http.Server{
		Addr:    <span class="hljs-string">"0.0.0.0:8080"</span>,
		Handler: router,
	}
	server.ListenAndServe()
}
</code></pre></div></article><!--$--><!--/$--><script src="/_next/static/chunks/b21aca2c9ac15a8a.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[70045,[\"/_next/static/chunks/1af1dd91bd03bb80.js\"],\"\"]\n3:I[56454,[\"/_next/static/chunks/cc5639b053815f24.js\",\"/_next/static/chunks/4904848246fadb45.js\"],\"default\"]\n4:I[10158,[\"/_next/static/chunks/cc5639b053815f24.js\",\"/_next/static/chunks/4904848246fadb45.js\"],\"default\"]\n6:I[25151,[\"/_next/static/chunks/cc5639b053815f24.js\",\"/_next/static/chunks/4904848246fadb45.js\"],\"OutletBoundary\"]\n7:\"$Sreact.suspense\"\n9:I[25151,[\"/_next/static/chunks/cc5639b053815f24.js\",\"/_next/static/chunks/4904848246fadb45.js\"],\"ViewportBoundary\"]\nb:I[25151,[\"/_next/static/chunks/cc5639b053815f24.js\",\"/_next/static/chunks/4904848246fadb45.js\"],\"MetadataBoundary\"]\nd:I[9442,[\"/_next/static/chunks/cc5639b053815f24.js\",\"/_next/static/chunks/4904848246fadb45.js\"],\"default\"]\n:HL[\"/_next/static/chunks/5cd79379acc82b6b.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"XcW8xoQAKlCXMZtt-Fu59\",\"c\":[\"\",\"docs\",\"20211022165454\"],\"q\":\"\",\"i\":false,\"f\":[[[\"\",{\"children\":[\"docs\",{\"children\":[[\"slug\",\"20211022165454\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/chunks/5cd79379acc82b6b.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/1af1dd91bd03bb80.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"ja\",\"children\":[\"$\",\"body\",null,{\"style\":{\"backgroundColor\":\"ghostwhite\",\"margin\":0,\"minHeight\":\"100vh\"},\"children\":[[\"$\",\"header\",null,{\"style\":{\"padding\":\"1rem 0\",\"marginBottom\":\"0.25rem\"},\"children\":[\"$\",\"div\",null,{\"style\":{\"maxWidth\":\"1000px\",\"margin\":\"0 auto\",\"padding\":\"0 2rem\"},\"children\":[\"$\",\"$L2\",null,{\"href\":\"/\",\"style\":{\"fontSize\":\"1.5rem\",\"fontWeight\":\"bold\",\"textDecoration\":\"none\",\"color\":\"#333\"},\"children\":\"MyDocs\"}]}]}],[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}]}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",null,[\"$\",\"$L6\",null,{\"children\":[\"$\",\"$7\",null,{\"name\":\"Next.MetadataOutlet\",\"children\":\"$@8\"}]}]]}],{},null,false,false]},null,false,false]},null,false,false]},null,false,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$L9\",null,{\"children\":\"$@a\"}],[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$Lb\",null,{\"children\":[\"$\",\"$7\",null,{\"name\":\"Next.Metadata\",\"children\":\"$@c\"}]}]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$d\",[]],\"S\":true}\n"])</script><script>self.__next_f.push([1,"e:T8126,"])</script><script>self.__next_f.push([1,"\u003ch2\u003eprisma のセットアップ\u003c/h2\u003e\n\u003cp\u003eまずは project の作成から。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e$ go mod init backend\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eclient のインストール。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e$ go get github.com/prisma/prisma-client-go\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eスキーマの作成。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e$ npx prisma init\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eprisma/schema.prisma\u003c/code\u003e と \u003ccode\u003e.env\u003c/code\u003e (と .gitignore ) が生成される。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e.env\u003c/code\u003e ファイルは \u003ccode\u003eDATABASE_URL\u003c/code\u003e を修正。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-env\"\u003e# Environment variables declared in this file are automatically made available to Prisma.\n# See the documentation for more detail: https://pris.ly/d/prisma-schema#using-environment-variables\n\n# Prisma supports the native connection string format for PostgreSQL, MySQL, SQLite, SQL Server and MongoDB (Preview).\n# See the documentation for all the connection string options: https://pris.ly/d/connection-strings\n\nDATABASE_URL=\"mysql://app:password@localhost:3306/app\"\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eprisma/schema.prisma\u003c/code\u003e は \u003ccode\u003eclient\u003c/code\u003e を \u003ccode\u003eprisma-client-go\u003c/code\u003e に、 \u003ccode\u003edatasource\u003c/code\u003e を \u003ccode\u003emysql\u003c/code\u003e に修正。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-schema.prisma\"\u003e// This is your Prisma schema file,\n// learn more about it in the docs: https://pris.ly/d/prisma-schema\n\ngenerator client {\n  provider = \"go run github.com/prisma/prisma-client-go\"\n}\n\ndatasource db {\n  provider = \"mysql\"\n  url      = env(\"DATABASE_URL\")\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eTask\u003c/code\u003e モデルを定義する。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-schema.prisma\"\u003e// This is your Prisma schema file,\n// learn more about it in the docs: https://pris.ly/d/prisma-schema\n\ngenerator client {\n  provider = \"go run github.com/prisma/prisma-client-go\"\n}\n\ndatasource db {\n  provider = \"mysql\"\n  url      = env(\"DATABASE_URL\")\n}\n\nmodel Task {\n  id String @default(cuid()) @id\n  createdAt DateTime @default(now())\n  updatedAt DateTime @updatedAt\n  title String\n  status Boolean\n  desc String?\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eprisma クライアントの作成.\n\u003ccode\u003eprisma/db/\u003c/code\u003e が生成される。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e$ go run github.com/prisma/prisma-client-go generate\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eDB にスキーマを反映させる。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e$ go run github.com/prisma/prisma-client-go migrate dev --name create_task\n\n~~\n~~\nmigrations/\n  └─ 20211022082219_create_task/\n    └─ migration.sql\n\nYour database is now \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003esync\u003c/span\u003e with your schema.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e既にスキーマファイルが存在する場合。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ego run github.com/prisma/prisma-client-go migrate dev\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eprisma/migrations/20211022082219_create_task/migration.sql\u003c/code\u003e を見てみる。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-sql\"\u003e\u003cspan class=\"hljs-comment\"\u003e-- CreateTable\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eCREATE TABLE\u003c/span\u003e `Task` (\n    `id` \u003cspan class=\"hljs-type\"\u003eVARCHAR\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e191\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003eNOT NULL\u003c/span\u003e,\n    `createdAt` DATETIME(\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003eNOT NULL\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eDEFAULT\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eCURRENT_TIMESTAMP\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e),\n    `updatedAt` DATETIME(\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003eNOT NULL\u003c/span\u003e,\n    `title` \u003cspan class=\"hljs-type\"\u003eVARCHAR\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e191\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003eNOT NULL\u003c/span\u003e,\n    `status` \u003cspan class=\"hljs-type\"\u003eBOOLEAN\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eNOT NULL\u003c/span\u003e,\n    `\u003cspan class=\"hljs-keyword\"\u003edesc\u003c/span\u003e` \u003cspan class=\"hljs-type\"\u003eVARCHAR\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e191\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003eNULL\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-keyword\"\u003ePRIMARY KEY\u003c/span\u003e (`id`)\n) \u003cspan class=\"hljs-keyword\"\u003eDEFAULT\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eCHARACTER SET\u003c/span\u003e utf8mb4 \u003cspan class=\"hljs-keyword\"\u003eCOLLATE\u003c/span\u003e utf8mb4_unicode_ci;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eテーブルも作成されている。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-mysql\"\u003emysql\u003e show tables;\n+--------------------+\n| Tables_in_app      |\n+--------------------+\n| _prisma_migrations |\n| Task               |\n+--------------------+\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eComment\u003c/code\u003e モデルを定義し、 \u003ccode\u003eTask\u003c/code\u003e モデルと関連付けを行う。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-schema.prisma\"\u003emodel Task {\n  id String @default(cuid()) @id\n  createdAt DateTime @default(now())\n  updatedAt DateTime @updatedAt\n  title String\n  status Boolean\n  desc String?\n\n  comments Comment[]\n}\n\nmodel Comment {\n  id String @default(cuid()) @id\n  createdAt DateTime @default(now())\n  updatedAt DateTime @updatedAt\n  content String\n\n  task Task @relation(fields: [taskId], references: [id])\n  taskId String\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003emigration を行う。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e$ go run github.com/prisma/prisma-client-go migrate dev --name add_comment_model\n\n~~\n~~\nmigrations/\n  └─ 20211022083117_add_comment_model/\n    └─ migration.sql\n\nYour database is now \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003esync\u003c/span\u003e with your schema.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003emigrations/20211022083117_add_comment_model/migration.sql\u003c/code\u003e を見る。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-sql\"\u003e\u003cspan class=\"hljs-comment\"\u003e-- CreateTable\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eCREATE TABLE\u003c/span\u003e `Comment` (\n    `id` \u003cspan class=\"hljs-type\"\u003eVARCHAR\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e191\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003eNOT NULL\u003c/span\u003e,\n    `createdAt` DATETIME(\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003eNOT NULL\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eDEFAULT\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eCURRENT_TIMESTAMP\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e),\n    `updatedAt` DATETIME(\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003eNOT NULL\u003c/span\u003e,\n    `content` \u003cspan class=\"hljs-type\"\u003eVARCHAR\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e191\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003eNOT NULL\u003c/span\u003e,\n    `taskId` \u003cspan class=\"hljs-type\"\u003eVARCHAR\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e191\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003eNOT NULL\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-keyword\"\u003ePRIMARY KEY\u003c/span\u003e (`id`)\n) \u003cspan class=\"hljs-keyword\"\u003eDEFAULT\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eCHARACTER SET\u003c/span\u003e utf8mb4 \u003cspan class=\"hljs-keyword\"\u003eCOLLATE\u003c/span\u003e utf8mb4_unicode_ci;\n\n\u003cspan class=\"hljs-comment\"\u003e-- AddForeignKey\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eALTER TABLE\u003c/span\u003e `Comment` \u003cspan class=\"hljs-keyword\"\u003eADD CONSTRAINT\u003c/span\u003e `Comment_taskId_fkey` \u003cspan class=\"hljs-keyword\"\u003eFOREIGN KEY\u003c/span\u003e (`taskId`) \u003cspan class=\"hljs-keyword\"\u003eREFERENCES\u003c/span\u003e `Task`(`id`) \u003cspan class=\"hljs-keyword\"\u003eON\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eDELETE\u003c/span\u003e RESTRICT \u003cspan class=\"hljs-keyword\"\u003eON\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eUPDATE\u003c/span\u003e CASCADE;\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003ePrisma Studio を使う\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003elocalhost:5555\u003c/code\u003e で起動する。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e$ npx prisma studio\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eprisma api syntax\u003c/h2\u003e\n\u003ch3\u003e全件取得する\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003etasks, err := client.Task.FindMany().Exec(context.Background())\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eクエリで取得する\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003etasks, err := client.Task.FindMany(\n  db.Task.Title.Equals(\u003cspan class=\"hljs-string\"\u003e\"1st task\"\u003c/span\u003e)\n  \u003cspan class=\"hljs-comment\"\u003e// \u0026#x3C;model\u003e.\u0026#x3C;field\u003e.\u0026#x3C;method\u003e.(value) 基本的にこの形式で使う\u003c/span\u003e\n).Exec(context.Background())\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e一意なデータを取得する\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003eschema.prisma\u003c/code\u003e で \u003ccode\u003e@id\u003c/code\u003e 、 \u003ccode\u003e@unique\u003c/code\u003e でマークされたもののみに使用可能。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003etask, err := client.Task.FindUnique(\n  db.Task.ID.Equals(\u003cspan class=\"hljs-string\"\u003e\"1234567890\"\u003c/span\u003e)\n).Exec(context.Background())\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e最初に見つかった 1 件を取得する\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003etask, err := client.Task.FindFirst(\n  db.Task.Title.Equals(\u003cspan class=\"hljs-string\"\u003e\"1st task\"\u003c/span\u003e)\n).Exec(context.Background())\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eスキーマのデータ型によってよしなにできる\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eString Filter\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003etasks, err := client.Task.FindMany(\n  \u003cspan class=\"hljs-comment\"\u003e// Title が \"1st task\" と一致する Task を取得\u003c/span\u003e\n  db.Task.Title.Equals(\u003cspan class=\"hljs-string\"\u003e\"1st task\"\u003c/span\u003e)\n\n  \u003cspan class=\"hljs-comment\"\u003e// Title に \"task\" を含む Task を取得\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// db.Task.Title.Contains(\"task\")\u003c/span\u003e\n\n  \u003cspan class=\"hljs-comment\"\u003e// Title が \"1st\" から始まる Task を取得\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// db.Task.Title.StartsWith(\"1st\")\u003c/span\u003e\n\n  \u003cspan class=\"hljs-comment\"\u003e// Title が \"task\" で終わる Task を取得\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// db.Task.Title.EndsWith(\"task\")\u003c/span\u003e\n).Exec(context.Background())\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eNumber Filter\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003e\u003cspan class=\"hljs-comment\"\u003e// \u0026#x3C;Field\u003e が 50 である \u0026#x3C;Model\u003e を取得\u003c/span\u003e\ndb.\u0026#x3C;Model\u003e.\u0026#x3C;Field\u003e.Equals(\u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e).Exec(context.Background())\n\n\u003cspan class=\"hljs-comment\"\u003e// \u0026#x3C;Field\u003e が 50 以下の \u0026#x3C;Model\u003e を取得\u003c/span\u003e\ndb.\u0026#x3C;Model\u003e.\u0026#x3C;Field\u003e.Lte(\u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e).Exec(context.Background())\n\n\u003cspan class=\"hljs-comment\"\u003e// \u0026#x3C;Field\u003e が 50 未満の \u0026#x3C;Model\u003e を取得\u003c/span\u003e\ndb.\u0026#x3C;Model\u003e.\u0026#x3C;Field\u003e.Lt(\u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e).Exec(context.Background())\n\n\u003cspan class=\"hljs-comment\"\u003e// \u0026#x3C;Field\u003e が 50 以上の \u0026#x3C;Model\u003e を取得\u003c/span\u003e\ndb.\u0026#x3C;Model\u003e.\u0026#x3C;Field\u003e.Gte(\u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e).Exec(context.Background())\n\n\u003cspan class=\"hljs-comment\"\u003e// \u0026#x3C;Field\u003e が 50 より大きいの \u0026#x3C;Model\u003e を取得\u003c/span\u003e\ndb.\u0026#x3C;Model\u003e.\u0026#x3C;Field\u003e.Gte(\u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e).Exec(context.Background())\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eTime Filter\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003etasks, err := client.Task.FindMany(\n  \u003cspan class=\"hljs-comment\"\u003e// 昨日作成された task を取得する\u003c/span\u003e\n  db.Task.CreatedAt.Equals(yesterday)\n\n  \u003cspan class=\"hljs-comment\"\u003e// 過去 6 時間で作られた task を取得する (createdAt \u003e 6 hours ago)\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// db.Task.Gt(time.Now().Add(-6 * time.Hour))\u003c/span\u003e\n\n  \u003cspan class=\"hljs-comment\"\u003e// 過去 6 時間で作られた task を取得する (createdAt \u003e= 6 hours ago)\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// db.Task.Gte(time.Now().Add(-6 * time.Hour))\u003c/span\u003e\n\n  \u003cspan class=\"hljs-comment\"\u003e// 昨日作成された task を取得する\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// db.Task.Lt(time.Now().Truncate(24 * time.Hour))\u003c/span\u003e\n\n  \u003cspan class=\"hljs-comment\"\u003e// 昨日作成された task を取得する (本日 00:00:00 を含む)\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// db.Task.Lte(time.Now().Truncate(24 * time.Hour))\u003c/span\u003e\n).Exec(context.Background())\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eNULL 関連\u003c/h3\u003e\n\u003cp\u003enull であるものを取得する。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003edb.Task.Content.EqualsOptional(\u003cspan class=\"hljs-literal\"\u003enil\u003c/span\u003e).Exec(context.Background())\n\ncontent := \u003cspan class=\"hljs-string\"\u003e\"string\"\u003c/span\u003e\ndb.Task.Content.EqualsOptional(\u0026#x26;content).Exec(context.Background())\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e他にも\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eNot\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003edb.Task.Not(\n  db.Task.Title.Equals(\u003cspan class=\"hljs-string\"\u003e\"1st task\"\u003c/span\u003e)\n).Exec(context.Background())\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eOr\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003edb.Task.Or(\n  db.Task.Title.Equals(\u003cspan class=\"hljs-string\"\u003e\"1st task\"\u003c/span\u003e),\n  db.Task.Desc.Equals(\u003cspan class=\"hljs-string\"\u003e\"new task\"\u003c/span\u003e)\n).Exec(context.Background())\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e関連付けされたクエリ\u003c/h3\u003e\n\u003cp\u003etask の title が \"1st task\" で comment が \"new content\" であるもの task を取得する。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003etasks, err := client.Task.FindMany(\n  db.Task.Title.Equals(\u003cspan class=\"hljs-string\"\u003e\"1st task\"\u003c/span\u003e)\n  db.Task.Comments.Some(\n    db.Comment.Content.Equals(\u003cspan class=\"hljs-string\"\u003e\"new content\"\u003c/span\u003e),\n  ),\n).Exec(context.Background())\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003ecreate\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003ecreated, err := client.Task.CreateOne(\n  db.Task.Title.Set(newTask.Title),\n  db.Task.Status.Set(newTask.Status),\n  db.Task.Desc.Set(newTask.Desc),\n).Exec(context.Background())\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e関連付けのあるデータの場合。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003ecreated, err := client.Comment.CreateOne(\n  db.Comment.Content.Set(newComment.Content),\n  db.Comment.Task.Link(\n    db.Task.ID.Equals(taskId),\n  ),\n).Exec(context.Background())\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eupdate\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003eupdated, err := client.Task.FindUnique(\n  db.Task.ID.Equals(taskId),\n).Update(\n  db.Task.Title.Set(newTask.Title),\n  db.Task.Status.Set(newTask.Status),\n  db.Task.Desc.Set(newTask.Desc),\n).Exec(context.Background())\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003edelete\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003e_, err := client.Task.FindUnique(\n  db.Task.ID.Equals(taskId),\n).Delete().Exec(context.Background())\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eソースコード全体\u003c/h3\u003e\n\u003cp\u003e今回は \u003ccode\u003egithub.com/gorilla/mux\u003c/code\u003e を使って API サーバを作った。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003e\u003cspan class=\"hljs-keyword\"\u003epackage\u003c/span\u003e main\n\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e (\n\t\u003cspan class=\"hljs-string\"\u003e\"backend/prisma/db\"\u003c/span\u003e\n\t\u003cspan class=\"hljs-string\"\u003e\"context\"\u003c/span\u003e\n\t\u003cspan class=\"hljs-string\"\u003e\"encoding/json\"\u003c/span\u003e\n\t\u003cspan class=\"hljs-string\"\u003e\"io\"\u003c/span\u003e\n\t\u003cspan class=\"hljs-string\"\u003e\"net/http\"\u003c/span\u003e\n\n\t\u003cspan class=\"hljs-string\"\u003e\"github.com/gorilla/mux\"\u003c/span\u003e\n)\n\n\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e Task \u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e {\n\tId        \u003cspan class=\"hljs-type\"\u003estring\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e`json:\"id\"`\u003c/span\u003e\n\tCreatedAt \u003cspan class=\"hljs-type\"\u003estring\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e`json:\"created_at\"`\u003c/span\u003e\n\tUpdatedAt \u003cspan class=\"hljs-type\"\u003estring\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e`json:\"updated_at\"`\u003c/span\u003e\n\tTitle     \u003cspan class=\"hljs-type\"\u003estring\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e`json:\"title\"`\u003c/span\u003e\n\tStatus    \u003cspan class=\"hljs-type\"\u003ebool\u003c/span\u003e   \u003cspan class=\"hljs-string\"\u003e`json:\"status\"`\u003c/span\u003e\n\tDesc      \u003cspan class=\"hljs-type\"\u003estring\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e`json:\"string\"`\u003c/span\u003e\n}\n\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e Comment \u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e {\n\tId        \u003cspan class=\"hljs-type\"\u003estring\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e`json:\"id\"`\u003c/span\u003e\n\tCreatedAt \u003cspan class=\"hljs-type\"\u003estring\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e`json:\"created_at\"`\u003c/span\u003e\n\tUpdatedAt \u003cspan class=\"hljs-type\"\u003estring\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e`json:\"updated_at\"`\u003c/span\u003e\n\tContent   \u003cspan class=\"hljs-type\"\u003estring\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e`json:\"content\"`\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003emain\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\u003c/span\u003e {\n\tclient := db.NewClient()\n\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e err := client.Prisma.Connect(); err != \u003cspan class=\"hljs-literal\"\u003enil\u003c/span\u003e {\n\t\t\u003cspan class=\"hljs-built_in\"\u003epanic\u003c/span\u003e(err)\n\t}\n\t\u003cspan class=\"hljs-keyword\"\u003edefer\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\u003c/span\u003e {\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e err := client.Prisma.Disconnect(); err != \u003cspan class=\"hljs-literal\"\u003enil\u003c/span\u003e {\n\t\t\t\u003cspan class=\"hljs-built_in\"\u003epanic\u003c/span\u003e(err)\n\t\t}\n\t}()\n\n\trouter := mux.NewRouter()\n\n\trouter.HandleFunc(\u003cspan class=\"hljs-string\"\u003e\"/tasks\"\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(w http.ResponseWriter, r *http.Request)\u003c/span\u003e\u003c/span\u003e {\n\t\t\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e newTask Task\n\t\terr := r.ParseForm()\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e err != \u003cspan class=\"hljs-literal\"\u003enil\u003c/span\u003e {\n\t\t\tio.WriteString(w, \u003cspan class=\"hljs-string\"\u003e\"ERROR: create task\"\u003c/span\u003e)\n\t\t}\n\t\tjson.NewDecoder(r.Body).Decode(\u0026#x26;newTask)\n\n\t\tcreated, err := client.Task.CreateOne(\n\t\t\tdb.Task.Title.Set(newTask.Title),\n\t\t\tdb.Task.Status.Set(newTask.Status),\n\t\t\tdb.Task.Desc.Set(newTask.Desc),\n\t\t).Exec(context.Background())\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e err != \u003cspan class=\"hljs-literal\"\u003enil\u003c/span\u003e {\n\t\t\tio.WriteString(w, \u003cspan class=\"hljs-string\"\u003e\"ERROR: create task\"\u003c/span\u003e)\n\t\t}\n\n\t\t\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e response \u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e {\n\t\t\tCode \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e    \u003cspan class=\"hljs-string\"\u003e`json:\"code\"`\u003c/span\u003e\n\t\t\tData []Task \u003cspan class=\"hljs-string\"\u003e`json:\"data\"`\u003c/span\u003e\n\t\t}\n\t\tresponse.Code = \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e\n\t\tresponse.Data = \u003cspan class=\"hljs-built_in\"\u003eappend\u003c/span\u003e(response.Data, Task{\n\t\t\tId:        created.ID,\n\t\t\tCreatedAt: created.CreatedAt.String(),\n\t\t\tUpdatedAt: created.UpdatedAt.String(),\n\t\t\tTitle:     created.Title,\n\t\t\tStatus:    created.Status,\n\t\t\tDesc: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003estring\u003c/span\u003e {\n\t\t\t\tdesc, ok := created.Desc()\n\t\t\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e !ok {\n\t\t\t\t\tdesc = \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\n\t\t\t\t}\n\t\t\t\t\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e desc\n\t\t\t}(),\n\t\t})\n\t\tresp, _ := json.Marshal(response)\n\t\tw.Header().Set(\u003cspan class=\"hljs-string\"\u003e\"Content-Type\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"application/json\"\u003c/span\u003e)\n\t\tw.Write(resp)\n\t}).Methods(\u003cspan class=\"hljs-string\"\u003e\"POST\"\u003c/span\u003e)\n\n\trouter.HandleFunc(\u003cspan class=\"hljs-string\"\u003e\"/tasks/{task_id}\"\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(w http.ResponseWriter, r *http.Request)\u003c/span\u003e\u003c/span\u003e {\n\t\tparams := mux.Vars(r)\n\t\ttaskId := params[\u003cspan class=\"hljs-string\"\u003e\"task_id\"\u003c/span\u003e]\n\n\t\ttask, err := client.Task.FindUnique(\n\t\t\tdb.Task.ID.Equals(taskId),\n\t\t).Exec(context.Background())\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e err != \u003cspan class=\"hljs-literal\"\u003enil\u003c/span\u003e {\n\t\t\tio.WriteString(w, \u003cspan class=\"hljs-string\"\u003e\"ERROR: read task\"\u003c/span\u003e)\n\t\t}\n\n\t\t\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e response \u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e {\n\t\t\tCode \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e    \u003cspan class=\"hljs-string\"\u003e`json:\"code\"`\u003c/span\u003e\n\t\t\tData []Task \u003cspan class=\"hljs-string\"\u003e`json:\"data\"`\u003c/span\u003e\n\t\t}\n\t\tresponse.Code = \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e\n\t\tresponse.Data = \u003cspan class=\"hljs-built_in\"\u003eappend\u003c/span\u003e(response.Data, Task{\n\t\t\tId:        task.ID,\n\t\t\tCreatedAt: task.CreatedAt.String(),\n\t\t\tUpdatedAt: task.UpdatedAt.String(),\n\t\t\tTitle:     task.Title,\n\t\t\tStatus:    task.Status,\n\t\t\tDesc: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003estring\u003c/span\u003e {\n\t\t\t\tdesc, ok := task.Desc()\n\t\t\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e !ok {\n\t\t\t\t\tdesc = \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\n\t\t\t\t}\n\t\t\t\t\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e desc\n\t\t\t}(),\n\t\t})\n\t\tresp, _ := json.Marshal(response)\n\t\tw.Header().Set(\u003cspan class=\"hljs-string\"\u003e\"Content-Type\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"application/json\"\u003c/span\u003e)\n\t\tw.Write(resp)\n\t}).Methods(\u003cspan class=\"hljs-string\"\u003e\"GET\"\u003c/span\u003e)\n\n\trouter.HandleFunc(\u003cspan class=\"hljs-string\"\u003e\"/tasks/{task_id}\"\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(w http.ResponseWriter, r *http.Request)\u003c/span\u003e\u003c/span\u003e {\n\t\tparams := mux.Vars(r)\n\t\ttaskId := params[\u003cspan class=\"hljs-string\"\u003e\"task_id\"\u003c/span\u003e]\n\t\t\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e newTask Task\n\t\terr := r.ParseForm()\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e err != \u003cspan class=\"hljs-literal\"\u003enil\u003c/span\u003e {\n\t\t\tio.WriteString(w, \u003cspan class=\"hljs-string\"\u003e\"ERROR: update task\"\u003c/span\u003e)\n\t\t}\n\t\tjson.NewDecoder(r.Body).Decode(\u0026#x26;newTask)\n\n\t\tupdated, err := client.Task.FindUnique(\n\t\t\tdb.Task.ID.Equals(taskId),\n\t\t).Update(\n\t\t\tdb.Task.Title.Set(newTask.Title),\n\t\t\tdb.Task.Status.Set(newTask.Status),\n\t\t\tdb.Task.Desc.Set(newTask.Desc),\n\t\t).Exec(context.Background())\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e err != \u003cspan class=\"hljs-literal\"\u003enil\u003c/span\u003e {\n\t\t\tio.WriteString(w, \u003cspan class=\"hljs-string\"\u003e\"ERROR: update task\"\u003c/span\u003e)\n\t\t}\n\t\t\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e response \u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e {\n\t\t\tCode \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e    \u003cspan class=\"hljs-string\"\u003e`json:\"code\"`\u003c/span\u003e\n\t\t\tData []Task \u003cspan class=\"hljs-string\"\u003e`json:\"data\"`\u003c/span\u003e\n\t\t}\n\t\tresponse.Code = \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e\n\t\tresponse.Data = \u003cspan class=\"hljs-built_in\"\u003eappend\u003c/span\u003e(response.Data, Task{\n\t\t\tId:        updated.ID,\n\t\t\tCreatedAt: updated.CreatedAt.String(),\n\t\t\tUpdatedAt: updated.UpdatedAt.String(),\n\t\t\tTitle:     updated.Title,\n\t\t\tStatus:    updated.Status,\n\t\t\tDesc: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003estring\u003c/span\u003e {\n\t\t\t\tdesc, ok := updated.Desc()\n\t\t\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e !ok {\n\t\t\t\t\tdesc = \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\n\t\t\t\t}\n\t\t\t\t\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e desc\n\t\t\t}(),\n\t\t})\n\t\tresp, _ := json.Marshal(response)\n\t\tw.Header().Set(\u003cspan class=\"hljs-string\"\u003e\"Content-Type\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"application/json\"\u003c/span\u003e)\n\t\tw.Write(resp)\n\t}).Methods(\u003cspan class=\"hljs-string\"\u003e\"POST\"\u003c/span\u003e)\n\n\trouter.HandleFunc(\u003cspan class=\"hljs-string\"\u003e\"/tasks/{task_id}\"\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(w http.ResponseWriter, r *http.Request)\u003c/span\u003e\u003c/span\u003e {\n\t\tparams := mux.Vars(r)\n\t\ttaskId := params[\u003cspan class=\"hljs-string\"\u003e\"task_id\"\u003c/span\u003e]\n\n\t\t_, err := client.Task.FindUnique(\n\t\t\tdb.Task.ID.Equals(taskId),\n\t\t).Delete().Exec(context.Background())\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e err != \u003cspan class=\"hljs-literal\"\u003enil\u003c/span\u003e {\n\t\t\tio.WriteString(w, \u003cspan class=\"hljs-string\"\u003e\"ERROR: delete task\"\u003c/span\u003e)\n\t\t}\n\n\t\ttasks, err := client.Task.FindMany().Exec(context.Background())\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e err != \u003cspan class=\"hljs-literal\"\u003enil\u003c/span\u003e {\n\t\t\tio.WriteString(w, \u003cspan class=\"hljs-string\"\u003e\"ERROR: read all task\"\u003c/span\u003e)\n\t\t}\n\t\t\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e responseData []Task\n\t\t\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e _, task := \u003cspan class=\"hljs-keyword\"\u003erange\u003c/span\u003e tasks {\n\t\t\tresponseData = \u003cspan class=\"hljs-built_in\"\u003eappend\u003c/span\u003e(responseData, Task{\n\t\t\t\tId:        task.ID,\n\t\t\t\tCreatedAt: task.CreatedAt.String(),\n\t\t\t\tUpdatedAt: task.UpdatedAt.String(),\n\t\t\t\tTitle:     task.Title,\n\t\t\t\tStatus:    \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n\t\t\t\tDesc: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003estring\u003c/span\u003e {\n\t\t\t\t\tdesc, ok := task.Desc()\n\t\t\t\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e !ok {\n\t\t\t\t\t\tdesc = \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\n\t\t\t\t\t}\n\t\t\t\t\t\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e desc\n\t\t\t\t}(),\n\t\t\t})\n\t\t}\n\t\t\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e response \u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e {\n\t\t\tCode \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e    \u003cspan class=\"hljs-string\"\u003e`json:\"code\"`\u003c/span\u003e\n\t\t\tData []Task \u003cspan class=\"hljs-string\"\u003e`json:\"data\"`\u003c/span\u003e\n\t\t}\n\t\tresponse.Code = \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e\n\t\tresponse.Data = \u003cspan class=\"hljs-built_in\"\u003eappend\u003c/span\u003e(response.Data, responseData...)\n\t\tresp, _ := json.Marshal(response)\n\t\tw.Header().Set(\u003cspan class=\"hljs-string\"\u003e\"Content-Type\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"application/json\"\u003c/span\u003e)\n\t\tw.Write(resp)\n\t}).Methods(\u003cspan class=\"hljs-string\"\u003e\"DELETE\"\u003c/span\u003e)\n\n\trouter.HandleFunc(\u003cspan class=\"hljs-string\"\u003e\"/tasks\"\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(w http.ResponseWriter, r *http.Request)\u003c/span\u003e\u003c/span\u003e {\n\t\ttasks, err := client.Task.FindMany().Exec(context.Background())\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e err != \u003cspan class=\"hljs-literal\"\u003enil\u003c/span\u003e {\n\t\t\tio.WriteString(w, \u003cspan class=\"hljs-string\"\u003e\"ERROR: read all task\"\u003c/span\u003e)\n\t\t}\n\t\t\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e responseData []Task\n\t\t\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e _, task := \u003cspan class=\"hljs-keyword\"\u003erange\u003c/span\u003e tasks {\n\t\t\tresponseData = \u003cspan class=\"hljs-built_in\"\u003eappend\u003c/span\u003e(responseData, Task{\n\t\t\t\tId:        task.ID,\n\t\t\t\tCreatedAt: task.CreatedAt.String(),\n\t\t\t\tUpdatedAt: task.UpdatedAt.String(),\n\t\t\t\tTitle:     task.Title,\n\t\t\t\tStatus:    \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n\t\t\t\tDesc: \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003estring\u003c/span\u003e {\n\t\t\t\t\tdesc, ok := task.Desc()\n\t\t\t\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e !ok {\n\t\t\t\t\t\tdesc = \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e\n\t\t\t\t\t}\n\t\t\t\t\t\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e desc\n\t\t\t\t}(),\n\t\t\t})\n\t\t}\n\t\t\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e response \u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e {\n\t\t\tCode \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e    \u003cspan class=\"hljs-string\"\u003e`json:\"code\"`\u003c/span\u003e\n\t\t\tData []Task \u003cspan class=\"hljs-string\"\u003e`json:\"data\"`\u003c/span\u003e\n\t\t}\n\t\tresponse.Code = \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e\n\t\tresponse.Data = \u003cspan class=\"hljs-built_in\"\u003eappend\u003c/span\u003e(response.Data, responseData...)\n\t\tresp, _ := json.Marshal(response)\n\t\tw.Header().Set(\u003cspan class=\"hljs-string\"\u003e\"Content-Type\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"application/json\"\u003c/span\u003e)\n\t\tw.Write(resp)\n\t}).Methods(\u003cspan class=\"hljs-string\"\u003e\"GET\"\u003c/span\u003e)\n\n\trouter.HandleFunc(\u003cspan class=\"hljs-string\"\u003e\"/tasks/{task_id}/comments\"\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(w http.ResponseWriter, r *http.Request)\u003c/span\u003e\u003c/span\u003e {\n\t\tparams := mux.Vars(r)\n\t\ttaskId := params[\u003cspan class=\"hljs-string\"\u003e\"task_id\"\u003c/span\u003e]\n\t\t\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e newComment Comment\n\t\terr := r.ParseForm()\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e err != \u003cspan class=\"hljs-literal\"\u003enil\u003c/span\u003e {\n\t\t\tio.WriteString(w, \u003cspan class=\"hljs-string\"\u003e\"ERROR: create comment\"\u003c/span\u003e)\n\t\t}\n\t\tjson.NewDecoder(r.Body).Decode(\u0026#x26;newComment)\n\n\t\tcreated, err := client.Comment.CreateOne(\n\t\t\tdb.Comment.Content.Set(newComment.Content),\n\t\t\tdb.Comment.Task.Link(\n\t\t\t\tdb.Task.ID.Equals(taskId),\n\t\t\t),\n\t\t).Exec(context.Background())\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e err != \u003cspan class=\"hljs-literal\"\u003enil\u003c/span\u003e {\n\t\t\tio.WriteString(w, \u003cspan class=\"hljs-string\"\u003e\"ERROR: create comment\"\u003c/span\u003e)\n\t\t}\n\t\t\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e response \u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e {\n\t\t\tCode \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e       \u003cspan class=\"hljs-string\"\u003e`json:\"code\"`\u003c/span\u003e\n\t\t\tData []Comment \u003cspan class=\"hljs-string\"\u003e`json:\"data\"`\u003c/span\u003e\n\t\t}\n\t\tresponse.Code = \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e\n\t\tresponse.Data = \u003cspan class=\"hljs-built_in\"\u003eappend\u003c/span\u003e(response.Data, Comment{\n\t\t\tId:        created.ID,\n\t\t\tCreatedAt: created.CreatedAt.String(),\n\t\t\tUpdatedAt: created.UpdatedAt.String(),\n\t\t\tContent:   created.Content,\n\t\t})\n\t\tresp, _ := json.Marshal(response)\n\t\tw.Header().Set(\u003cspan class=\"hljs-string\"\u003e\"Content-Type\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"application/json\"\u003c/span\u003e)\n\t\tw.Write(resp)\n\t}).Methods(\u003cspan class=\"hljs-string\"\u003e\"POST\"\u003c/span\u003e)\n\n\trouter.HandleFunc(\u003cspan class=\"hljs-string\"\u003e\"/tasks/{task_id}/comments\"\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(w http.ResponseWriter, r *http.Request)\u003c/span\u003e\u003c/span\u003e {\n\t\tparams := mux.Vars(r)\n\t\ttaskId := params[\u003cspan class=\"hljs-string\"\u003e\"task_id\"\u003c/span\u003e]\n\t\tcomments, err := client.Comment.FindMany(\n\t\t\tdb.Comment.TaskID.Equals(taskId),\n\t\t).Exec(context.Background())\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e err != \u003cspan class=\"hljs-literal\"\u003enil\u003c/span\u003e {\n\t\t\tio.WriteString(w, \u003cspan class=\"hljs-string\"\u003e\"ERROR: read comment\"\u003c/span\u003e)\n\t\t}\n\t\t\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e responseData []Comment\n\t\t\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e _, comment := \u003cspan class=\"hljs-keyword\"\u003erange\u003c/span\u003e comments {\n\t\t\tresponseData = \u003cspan class=\"hljs-built_in\"\u003eappend\u003c/span\u003e(responseData, Comment{\n\t\t\t\tId:        comment.ID,\n\t\t\t\tCreatedAt: comment.CreatedAt.String(),\n\t\t\t\tUpdatedAt: comment.UpdatedAt.String(),\n\t\t\t\tContent:   comment.Content,\n\t\t\t})\n\t\t}\n\t\t\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e response \u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e {\n\t\t\tCode \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e       \u003cspan class=\"hljs-string\"\u003e`json:\"code\"`\u003c/span\u003e\n\t\t\tData []Comment \u003cspan class=\"hljs-string\"\u003e`json:\"data\"`\u003c/span\u003e\n\t\t}\n\t\tresponse.Code = \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e\n\t\tresponse.Data = \u003cspan class=\"hljs-built_in\"\u003eappend\u003c/span\u003e(response.Data, responseData...)\n\t\tresp, _ := json.Marshal(response)\n\t\tw.Header().Set(\u003cspan class=\"hljs-string\"\u003e\"Content-Type\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"application/json\"\u003c/span\u003e)\n\t\tw.Write(resp)\n\t}).Methods(\u003cspan class=\"hljs-string\"\u003e\"GET\"\u003c/span\u003e)\n\n\trouter.HandleFunc(\u003cspan class=\"hljs-string\"\u003e\"/tasks/{task_id}/comments/{comment_id}\"\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(w http.ResponseWriter, r *http.Request)\u003c/span\u003e\u003c/span\u003e {\n\t\tparams := mux.Vars(r)\n\t\tcommentId := params[\u003cspan class=\"hljs-string\"\u003e\"comment_id\"\u003c/span\u003e]\n\t\t\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e newComment Comment\n\t\terr := r.ParseForm()\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e err != \u003cspan class=\"hljs-literal\"\u003enil\u003c/span\u003e {\n\t\t\tio.WriteString(w, \u003cspan class=\"hljs-string\"\u003e\"ERROR: update comment\"\u003c/span\u003e)\n\t\t}\n\t\tjson.NewDecoder(r.Body).Decode(\u0026#x26;newComment)\n\n\t\tupdated, err := client.Comment.FindUnique(\n\t\t\tdb.Comment.ID.Equals(commentId),\n\t\t).Update(\n\t\t\tdb.Comment.Content.Set(newComment.Content),\n\t\t).Exec(context.Background())\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e err != \u003cspan class=\"hljs-literal\"\u003enil\u003c/span\u003e {\n\t\t\tio.WriteString(w, \u003cspan class=\"hljs-string\"\u003e\"update error\"\u003c/span\u003e)\n\t\t}\n\t\t\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e response \u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e {\n\t\t\tCode \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e       \u003cspan class=\"hljs-string\"\u003e`json:\"code\"`\u003c/span\u003e\n\t\t\tData []Comment \u003cspan class=\"hljs-string\"\u003e`json:\"comment\"`\u003c/span\u003e\n\t\t}\n\t\tresponse.Code = \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e\n\t\tresponse.Data = \u003cspan class=\"hljs-built_in\"\u003eappend\u003c/span\u003e(response.Data, Comment{\n\t\t\tId:        updated.ID,\n\t\t\tCreatedAt: updated.CreatedAt.String(),\n\t\t\tUpdatedAt: updated.UpdatedAt.String(),\n\t\t\tContent:   updated.Content,\n\t\t})\n\t\tresp, _ := json.Marshal(response)\n\t\tw.Header().Set(\u003cspan class=\"hljs-string\"\u003e\"Content-Type\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"application/json\"\u003c/span\u003e)\n\t\tw.Write(resp)\n\t}).Methods(\u003cspan class=\"hljs-string\"\u003e\"POST\"\u003c/span\u003e)\n\n\trouter.HandleFunc(\u003cspan class=\"hljs-string\"\u003e\"/tasks/{task_id}/comments/{comment_id}\"\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(w http.ResponseWriter, r *http.Request)\u003c/span\u003e\u003c/span\u003e {\n\t\tparams := mux.Vars(r)\n\t\ttaskId := params[\u003cspan class=\"hljs-string\"\u003e\"task_id\"\u003c/span\u003e]\n\t\tcommentId := params[\u003cspan class=\"hljs-string\"\u003e\"comment_id\"\u003c/span\u003e]\n\n\t\t_, err := client.Comment.FindUnique(\n\t\t\tdb.Comment.ID.Equals(commentId),\n\t\t).Delete().Exec(context.Background())\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e err != \u003cspan class=\"hljs-literal\"\u003enil\u003c/span\u003e {\n\t\t\tio.WriteString(w, \u003cspan class=\"hljs-string\"\u003e\"ERROR: delete comment\"\u003c/span\u003e)\n\t\t}\n\n\t\tcomments, err := client.Comment.FindMany(\n\t\t\tdb.Comment.TaskID.Equals(taskId),\n\t\t).Exec(context.Background())\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e err != \u003cspan class=\"hljs-literal\"\u003enil\u003c/span\u003e {\n\t\t\tio.WriteString(w, \u003cspan class=\"hljs-string\"\u003e\"ERROR: read all comment\"\u003c/span\u003e)\n\t\t}\n\t\t\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e responseData []Comment\n\t\t\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e _, comment := \u003cspan class=\"hljs-keyword\"\u003erange\u003c/span\u003e comments {\n\t\t\tresponseData = \u003cspan class=\"hljs-built_in\"\u003eappend\u003c/span\u003e(responseData, Comment{\n\t\t\t\tId:        comment.ID,\n\t\t\t\tCreatedAt: comment.CreatedAt.String(),\n\t\t\t\tUpdatedAt: comment.UpdatedAt.String(),\n\t\t\t\tContent:   comment.Content,\n\t\t\t})\n\t\t}\n\t\t\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e response \u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e {\n\t\t\tCode \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e       \u003cspan class=\"hljs-string\"\u003e`json:\"code\"`\u003c/span\u003e\n\t\t\tData []Comment \u003cspan class=\"hljs-string\"\u003e`json:\"data\"`\u003c/span\u003e\n\t\t}\n\t\tresponse.Code = \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e\n\t\tresponse.Data = \u003cspan class=\"hljs-built_in\"\u003eappend\u003c/span\u003e(response.Data, responseData...)\n\t\tresp, _ := json.Marshal(response)\n\t\tw.Header().Set(\u003cspan class=\"hljs-string\"\u003e\"Content-Type\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"application/json\"\u003c/span\u003e)\n\t\tw.Write(resp)\n\t}).Methods(\u003cspan class=\"hljs-string\"\u003e\"DELETE\"\u003c/span\u003e)\n\n\tserver := http.Server{\n\t\tAddr:    \u003cspan class=\"hljs-string\"\u003e\"0.0.0.0:8080\"\u003c/span\u003e,\n\t\tHandler: router,\n\t}\n\tserver.ListenAndServe()\n}\n\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"5:[\"$\",\"article\",null,{\"style\":{\"maxWidth\":\"1000px\",\"margin\":\"0 auto\",\"padding\":\"0 2rem 2rem\"},\"children\":[[\"$\",\"h1\",null,{\"children\":\"prisma-client-goを試した\"}],[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$e\"}}]]}]\n"])</script><script>self.__next_f.push([1,"a:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"title\",\"0\",{\"children\":\"MyDocs\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"A simple SSG blog built with Next.js\"}]]\n8:null\n"])</script></body></html>