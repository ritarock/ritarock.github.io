1:"$Sreact.fragment"
3:I[25151,["/_next/static/chunks/cc5639b053815f24.js","/_next/static/chunks/4904848246fadb45.js"],"OutletBoundary"]
4:"$Sreact.suspense"
2:T650,<p><a href="https://echo.labstack.com/cookbook/middleware/">公式ドキュメント</a>を参考に今回はアクセスの回数をログに出力する middleware を実装する。</p>
<p>middleware は <code>echo.HandlerFunc</code> を返す関数を作れば良さそう。</p>
<pre><code class="hljs language-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"sync"</span>

	<span class="hljs-string">"github.com/labstack/echo/v4"</span>
)

<span class="hljs-keyword">type</span> Counter <span class="hljs-keyword">struct</span> {
	mutex sync.Mutex
	value <span class="hljs-type">int</span>
}

<span class="hljs-keyword">var</span> counter = <span class="hljs-built_in">new</span>(Counter)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">accessCounter</span><span class="hljs-params">(next echo.HandlerFunc)</span></span> echo.HandlerFunc {
	<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c echo.Context)</span></span> <span class="hljs-type">error</span> {
		counter.mutex.Lock()
		counter.value++
		counter.mutex.Unlock()
		fmt.Println(counter.value)
		<span class="hljs-keyword">return</span> next(c)
	}
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	e := echo.New()

	e.Use(accessCounter)
	e.Start(<span class="hljs-string">":8080"</span>)
}

</code></pre>0:{"buildId":"k4nLm51W6XhhWj7FO7xal","rsc":["$","$1","c",{"children":[["$","article",null,{"style":{"maxWidth":"1000px","margin":"0 auto","padding":"0 2rem 2rem"},"children":[["$","h1",null,{"children":"echoでmiddlewareを実装する"}],["$","div",null,{"dangerouslySetInnerHTML":{"__html":"$2"}}]]}],null,["$","$L3",null,{"children":["$","$4",null,{"name":"Next.MetadataOutlet","children":"$@5"}]}]]}],"loading":null,"isPartial":false}
5:null
