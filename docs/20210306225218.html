<!DOCTYPE html><!--nvFx_FV4eLnf8EmFzYlmi--><html lang="ja"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/5e22d3fe14facb50.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-a736bdd7de20ec56.js"/><script src="/_next/static/chunks/c2bb8663-25b9ddcb298b2a19.js" async=""></script><script src="/_next/static/chunks/933-bc707027486726a4.js" async=""></script><script src="/_next/static/chunks/main-app-72d284f8ed369795.js" async=""></script><script src="/_next/static/chunks/119-2ee48d1f375d3fd9.js" async=""></script><script src="/_next/static/chunks/app/page-ee49d1414c09869d.js" async=""></script><title>MyDocs</title><meta name="description" content="A simple SSG blog built with Next.js"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body style="background-color:ghostwhite;margin:0;min-height:100vh"><div hidden=""><!--$--><!--/$--></div><header style="padding:1rem 0;margin-bottom:0.25rem"><div style="max-width:1000px;margin:0 auto;padding:0 2rem"><a style="font-size:1.5rem;font-weight:bold;text-decoration:none;color:#333" href="/">MyDocs</a></div></header><article style="max-width:1000px;margin:0 auto;padding:0 2rem 2rem"><h1>Dockerとdocker-composeのまとめ</h1><div><h2>Docker</h2>
<p><code>Dockerfile</code> を元にイメージを構築する。</p>
<h3>build</h3>
<p><code>Dockerfile</code> が存在するディレクトリで実行する。</p>
<pre><code class="hljs language-bash">$ docker build .
</code></pre>
<p><code>-f</code> オプションを使うことで Dockerfile のパスを指定できる。</p>
<pre><code class="hljs language-bash">$ docker build -f /path/to/Dockerfile .
</code></pre>
<h3>FROM</h3>
<p>ベースイメージを指定する。</p>
<pre><code class="hljs language-Dockerfile">FROM &#x3C;image>[:&#x3C;tag>][AS &#x3C;name>]
</code></pre>
<p><code>AS &#x3C;name></code> でステージに名前を付けて、以降の <code>FROM</code> と <code>COPY --from=&#x3C;name></code> 命令で構築イメージを参照できる。</p>
<h3>RUN</h3>
<p>シェルとして実行される。</p>
<pre><code class="hljs language-Dockerfile">RUN /bin/sh -c 'source $HOME/.bashrc;' \
echo $HOME
</code></pre>
<p>1 行で書く場合。</p>
<pre><code class="hljs language-Dockerfile">RUN /bin/sh -c 'source $HOME/.bashrc; echo $HOME'
</code></pre>
<p><code>bash/sh</code> 以外のシェルを使う場合は <code>exec</code> 形式でシェルに引数を渡す。</p>
<pre><code class="hljs language-Dockerfile">RUN ["/bin/bash", "-c", "echo hello"]
</code></pre>
<p><code>exec</code> 形式で書く場合は json 配列として扱わるため <code>""</code> で囲む必要がある。</p>
<h3>CMD</h3>
<p><code>Dockerfile</code> 内の <code>CMD</code> 命令は 1 つのみ。複数あっても最後の <code>CMD</code> 命令のみが実行される。
<strong>CMD の目的はコンテナの実行時のデフォルトの処理を指定する</strong></p>
<pre><code class="hljs language-Dockerfile">FROM ubuntu
CMD ["/usr/bin/wc", "--help"]
</code></pre>
<h3>ADD / COPY</h3>
<p><code>&#x3C;src></code> で指定したファイル、ディレクトリをコンテナ内の <code>&#x3C;dest></code> にコピーする。
ローカルのファイルをコンテナにコピーしたい場合は <code>COPY</code> を使う。
<code>ADD</code> はローカルでの圧縮ファイルの展開やリモートファイルの展開したい場面で使う。</p>
<pre><code class="hljs language-Dockerfile">ADD [--chown=&#x3C;ユーザ>:&#x3C;グループ>] &#x3C;src> &#x3C;dest>
COPY [--chown=&#x3C;ユーザ>:&#x3C;グループ>] &#x3C;src> &#x3C;dest>
</code></pre>
<h3>EXPOSE</h3>
<p>コンテナが接続するためのリッスンするポートを指定する。</p>
<pre><code class="hljs language-Dockerfile">EXPOSE 80
</code></pre>
<p>実際にはポートの公開は行われない。ドキュメント的な用途として使われる。
実際に公開して使うには、 <code>docker run</code> の際にフラグをつける。</p>
<pre><code class="hljs language-bash">$ docker run --<span class="hljs-built_in">rm</span> -it -p 80:80 &#x3C;image> bash
</code></pre>
<h3>ENV</h3>
<p>環境変数の設定をする。</p>
<pre><code class="hljs language-Dockerfile">ENV &#x3C;key>=&#x3C;value>
</code></pre>
<p>環境変数は、 <code>Dockerfile</code> 内の変数として使える。
使い方は、 <code>$variable_name</code> もしくは、 <code>${variable_name}</code></p>
<pre><code class="hljs language-Dockerfile">FROM &#x3C;image>
ENV FOO=/bar
WORKDIR ${FOO} # WORKDIR /bar
</code></pre>
<h3>ENTRYPOINT</h3>
<p>最適な使い方はイメージに対してメインのコマンドを設定しておき、 <code>CMD</code> を使ってデフォルトフラグを指定する。</p>
<pre><code class="hljs language-Dockerfile">ENTRYPOINT ["go"]
CMD ["--help"]
</code></pre>
<p>パラメータを指定して起動することでコマンドの実行ができる。</p>
<pre><code class="hljs language-bash">$ docker run &#x3C;image> run main.go
</code></pre>
<h3>VOLUME</h3>
<p>コンテナによって作成されるファイルやフォルダの公開に使う。イメージの可変的な部分、ユーザが設定可能な部分について使う。</p>
<h3>USER</h3>
<p>非 root ユーザで実行可能な場合は <code>USER</code> を使ってユーザの変更する。</p>
<pre><code class="hljs language-Dockerfile">USER &#x3C;ユーザ>[:&#x3C;グループ>]
</code></pre>
<h3>WORKDIR</h3>
<p>Dockerfile で続く <code>RUN</code>、 <code>CMD</code>、 <code>ENTRYPOINT</code>、 <code>COPY / ADD</code> の命令の処理時で使う作業ディレクトリを指定する。</p>
<h3>ARG</h3>
<p><code>build</code> 時にユーザが渡せる変数を定義する。
構築時には <code>docker build --build-arg &#x3C;変数名>=&#x3C;値></code> を指定する。</p>
<pre><code class="hljs language-Dockerfile">ARG &#x3C;name>[=&#x3C;デフォルト値>]
</code></pre>
<h2>docker-compose</h2>
<p>サービスを定義する。</p>
<h3>build</h3>
<p>ビルド時に適用される。</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">services:</span>
  <span class="hljs-attr">webapp:</span>
    <span class="hljs-attr">build:</span> <span class="hljs-string">./dir</span>
</code></pre>
<p><code>context</code> でパスを指定し, <code>Dockerfile</code> や <code>args</code> も指定できる。</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">services:</span>
  <span class="hljs-attr">webapp:</span>
    <span class="hljs-attr">build:</span>
      <span class="hljs-attr">context:</span> <span class="hljs-string">./dir</span>
      <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">Dockerfile-alternate</span>
      <span class="hljs-attr">args:</span>
        <span class="hljs-attr">buildno:</span> <span class="hljs-number">1</span>
</code></pre>
<p><code>image</code> 名と <code>tag</code> を指定できる。</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">build:</span> <span class="hljs-string">./dir</span>
<span class="hljs-attr">image:</span> <span class="hljs-string">webapp:tag</span>
</code></pre>
<h3>context</h3>
<p><code>Dockerfile</code> を含むディレクトリへのパスか、 git リポジトリの URL を指定する。</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">build:</span>
  <span class="hljs-attr">context:</span> <span class="hljs-string">./dir</span>
</code></pre>
<h3>dockerfile</h3>
<p>別の <code>Dockerfile</code> を指定する。この場合、ビルドパスを同時に指定する必要がある。</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">build:</span>
  <span class="hljs-attr">context:</span> <span class="hljs-string">.</span>
  <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">Dockerfile-alternate</span>
</code></pre>
<h3>args</h3>
<p>ビルド時にのみ有効な環境変数を設定する。
個々をマッピングするか、リストで書く.ブール値はクォートで囲む。</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">build:</span>
  <span class="hljs-attr">context:</span> <span class="hljs-string">.</span>
  <span class="hljs-attr">args:</span>
    <span class="hljs-attr">buildno:</span> <span class="hljs-number">1</span>
    <span class="hljs-attr">gitcommithash:</span> <span class="hljs-string">abc123</span>
</code></pre>
<pre><code class="hljs language-yml"><span class="hljs-attr">build:</span>
  <span class="hljs-attr">context:</span> <span class="hljs-string">.</span>
  <span class="hljs-attr">args:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">buildno=1</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">gitcommithash=abc123</span>
</code></pre>
<h3>command</h3>
<p>デフォルトのコマンドを上書きする。</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">command:</span> <span class="hljs-string">bundle</span> <span class="hljs-string">exec</span> <span class="hljs-string">thin</span> <span class="hljs-string">-p</span> <span class="hljs-number">3000</span>
</code></pre>
<p>リスト形式も可能。</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">command:</span> [<span class="hljs-string">"bundle"</span>, <span class="hljs-string">"exec"</span>, <span class="hljs-string">"thin"</span>, <span class="hljs-string">"-p"</span>, <span class="hljs-string">"3000"</span>]
</code></pre>
<h3>depends_on</h3>
<p>サービス起動の依存関係を表す。
以下の場合、 db と redis の起動後に web が起動する。</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">version:</span> <span class="hljs-string">"3.9"</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">web:</span>
    <span class="hljs-attr">build:</span> <span class="hljs-string">.</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">db</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis</span>
  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">redis</span>
  <span class="hljs-attr">db:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">postgres</span>
</code></pre>
<h3>entrypoint</h3>
<p>デフォルトのエントリーポイントを上書きする。</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">entrypoint:</span> <span class="hljs-string">/code/entrypoint.sh</span>
</code></pre>
<p>リスト形式も可能。</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">entrypoint:</span> [<span class="hljs-string">"php"</span>, <span class="hljs-string">"-d"</span>, <span class="hljs-string">"memry_limit=1"</span>, <span class="hljs-string">"vendor/bin/phpunit"</span>]
</code></pre>
<h3>environment</h3>
<p>環境変数を追加する。
個々をマッピングするか,リストで書く.ブール値はクォートで囲む。</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">environment:</span>
  <span class="hljs-attr">RACK_ENV:</span> <span class="hljs-string">development</span>
  <span class="hljs-attr">SHOW:</span> <span class="hljs-string">'true'</span>
  <span class="hljs-attr">SESSION_SECRET:</span>
</code></pre>
<pre><code class="hljs language-yml"><span class="hljs-attr">environment:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">RACK_ENV=development</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">SHOW=true</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">SESSION_SECRET</span>
</code></pre>
<h3>expose</h3>
<p>ホストマシンにはポートを公開せずに,ポートを expose する.
リンクされたサービスのみアクセス可能。</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">expose:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">"3000"</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">"8000"</span>
</code></pre>
<h3>external_links</h3>
<p>実行する <code>docker-compose.yml</code> 以外から起動されたコンテナをリンクする。
コンテナ名とエイリアス名 (CONTAINER:ALIAS) を指定する。</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">external_links:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">redis_1</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">project_db_1:mysql</span>
</code></pre>
<h3>extra_hosts</h3>
<p>ホスト名をマッピングに追加する。
<code>/etc/hosts</code> に追加される。</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">extra_hosts:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">"somehost:162.242.195.82"</span>
</code></pre>
<h3>ports</h3>
<p>公開用のポートを設定する。
ホスト側とコンテナ側のポートを指定する( <code>HOST:CONTAINER</code> )。
もしくは、コンテナ側のポートを指定する。</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">ports:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">"3000"</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">"3000-3005"</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">"8000:8000"</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">"9090-9091:8080-8081"</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">"49100:22"</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">"127.0.0.1:8001:8001"</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">"127.0.0.1:5000-5010:5000-5010"</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">"6060:6060/udp"</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">"12400-12500:1240"</span>
</code></pre>
<h3>volumes</h3>
<p>複数のサービスにわたってボリュームを再利用したい場合、最上位の <code>volumes</code> キーで名前付きボリュームを定義する。
以下の場合、 db サービスのデータディレクトリは、 backup サービスのボリュームにも共有させている。</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">version:</span> <span class="hljs-string">"3.9"</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">db:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">db</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">data-volume:/var/lib/db</span>
  <span class="hljs-attr">backup:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">backup-service</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">data-volume:/var/lib/backup/data</span>
<span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">data-volume:</span>
</code></pre>
<p>短い書き方では、 <code>[SOURCE:]TARGET[:MODE]</code> と書ける。 <code>ro</code> は <code>readonly</code> 。</p>
<pre><code class="hljs language-yml"><span class="hljs-bullet">-</span> <span class="hljs-string">./cache:/tmp/cache:ro</span>
</code></pre>
<h3>変数の置換</h3>
<p>シェル環境に <code>POSTGRES_VERSION=9.3</code> が定義されていると、 postgres のバージョンは 9.3 になる。</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">db:</span>
  <span class="hljs-attr">image:</span> <span class="hljs-string">"postgres:${POSTGRES_VERSION}"</span>
</code></pre>
<p>環境変数が設定されていない場合は空文字になる。
環境変数のデフォルト値は <code>.env</code> ファイルに設定しておくことができる。</p>
<ul>
<li>${VARIABLE:-default} は VARIABLE がセットされていないか, 空文字のときに <code>default</code> として評価される</li>
<li>${VARIABLE-default} は VARIABLE がセットされているときのみ <code>default</code> として評価される</li>
</ul></div></article><!--$--><!--/$--><script src="/_next/static/chunks/webpack-a736bdd7de20ec56.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[9119,[\"119\",\"static/chunks/119-2ee48d1f375d3fd9.js\",\"974\",\"static/chunks/app/page-ee49d1414c09869d.js\"],\"\"]\n3:I[730,[],\"\"]\n4:I[2392,[],\"\"]\n6:I[3811,[],\"OutletBoundary\"]\n8:I[4338,[],\"AsyncMetadataOutlet\"]\na:I[3811,[],\"ViewportBoundary\"]\nc:I[3811,[],\"MetadataBoundary\"]\nd:\"$Sreact.suspense\"\nf:I[9426,[],\"\"]\n:HL[\"/_next/static/css/5e22d3fe14facb50.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"nvFx_FV4eLnf8EmFzYlmi\",\"p\":\"\",\"c\":[\"\",\"docs\",\"20210306225218\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"docs\",{\"children\":[[\"slug\",\"20210306225218\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/5e22d3fe14facb50.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"ja\",\"children\":[\"$\",\"body\",null,{\"style\":{\"backgroundColor\":\"ghostwhite\",\"margin\":0,\"minHeight\":\"100vh\"},\"children\":[[\"$\",\"header\",null,{\"style\":{\"padding\":\"1rem 0\",\"marginBottom\":\"0.25rem\"},\"children\":[\"$\",\"div\",null,{\"style\":{\"maxWidth\":\"1000px\",\"margin\":\"0 auto\",\"padding\":\"0 2rem\"},\"children\":[\"$\",\"$L2\",null,{\"href\":\"/\",\"style\":{\"fontSize\":\"1.5rem\",\"fontWeight\":\"bold\",\"textDecoration\":\"none\",\"color\":\"#333\"},\"children\":\"MyDocs\"}]}]}],[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}]}]]}],{\"children\":[\"docs\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"20210306225218\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",null,[\"$\",\"$L6\",null,{\"children\":[\"$L7\",[\"$\",\"$L8\",null,{\"promise\":\"$@9\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[[\"$\",\"$La\",null,{\"children\":\"$Lb\"}],null],[\"$\",\"$Lc\",null,{\"children\":[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$d\",null,{\"fallback\":null,\"children\":\"$Le\"}]}]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$f\",[]],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"10:T3b01,"])</script><script>self.__next_f.push([1,"\u003ch2\u003eDocker\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003eDockerfile\u003c/code\u003e を元にイメージを構築する。\u003c/p\u003e\n\u003ch3\u003ebuild\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003eDockerfile\u003c/code\u003e が存在するディレクトリで実行する。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e$ docker build .\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003e-f\u003c/code\u003e オプションを使うことで Dockerfile のパスを指定できる。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e$ docker build -f /path/to/Dockerfile .\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eFROM\u003c/h3\u003e\n\u003cp\u003eベースイメージを指定する。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-Dockerfile\"\u003eFROM \u0026#x3C;image\u003e[:\u0026#x3C;tag\u003e][AS \u0026#x3C;name\u003e]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eAS \u0026#x3C;name\u003e\u003c/code\u003e でステージに名前を付けて、以降の \u003ccode\u003eFROM\u003c/code\u003e と \u003ccode\u003eCOPY --from=\u0026#x3C;name\u003e\u003c/code\u003e 命令で構築イメージを参照できる。\u003c/p\u003e\n\u003ch3\u003eRUN\u003c/h3\u003e\n\u003cp\u003eシェルとして実行される。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-Dockerfile\"\u003eRUN /bin/sh -c 'source $HOME/.bashrc;' \\\necho $HOME\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e1 行で書く場合。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-Dockerfile\"\u003eRUN /bin/sh -c 'source $HOME/.bashrc; echo $HOME'\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003ebash/sh\u003c/code\u003e 以外のシェルを使う場合は \u003ccode\u003eexec\u003c/code\u003e 形式でシェルに引数を渡す。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-Dockerfile\"\u003eRUN [\"/bin/bash\", \"-c\", \"echo hello\"]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eexec\u003c/code\u003e 形式で書く場合は json 配列として扱わるため \u003ccode\u003e\"\"\u003c/code\u003e で囲む必要がある。\u003c/p\u003e\n\u003ch3\u003eCMD\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003eDockerfile\u003c/code\u003e 内の \u003ccode\u003eCMD\u003c/code\u003e 命令は 1 つのみ。複数あっても最後の \u003ccode\u003eCMD\u003c/code\u003e 命令のみが実行される。\n\u003cstrong\u003eCMD の目的はコンテナの実行時のデフォルトの処理を指定する\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-Dockerfile\"\u003eFROM ubuntu\nCMD [\"/usr/bin/wc\", \"--help\"]\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eADD / COPY\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003e\u0026#x3C;src\u003e\u003c/code\u003e で指定したファイル、ディレクトリをコンテナ内の \u003ccode\u003e\u0026#x3C;dest\u003e\u003c/code\u003e にコピーする。\nローカルのファイルをコンテナにコピーしたい場合は \u003ccode\u003eCOPY\u003c/code\u003e を使う。\n\u003ccode\u003eADD\u003c/code\u003e はローカルでの圧縮ファイルの展開やリモートファイルの展開したい場面で使う。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-Dockerfile\"\u003eADD [--chown=\u0026#x3C;ユーザ\u003e:\u0026#x3C;グループ\u003e] \u0026#x3C;src\u003e \u0026#x3C;dest\u003e\nCOPY [--chown=\u0026#x3C;ユーザ\u003e:\u0026#x3C;グループ\u003e] \u0026#x3C;src\u003e \u0026#x3C;dest\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eEXPOSE\u003c/h3\u003e\n\u003cp\u003eコンテナが接続するためのリッスンするポートを指定する。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-Dockerfile\"\u003eEXPOSE 80\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e実際にはポートの公開は行われない。ドキュメント的な用途として使われる。\n実際に公開して使うには、 \u003ccode\u003edocker run\u003c/code\u003e の際にフラグをつける。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e$ docker run --\u003cspan class=\"hljs-built_in\"\u003erm\u003c/span\u003e -it -p 80:80 \u0026#x3C;image\u003e bash\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eENV\u003c/h3\u003e\n\u003cp\u003e環境変数の設定をする。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-Dockerfile\"\u003eENV \u0026#x3C;key\u003e=\u0026#x3C;value\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e環境変数は、 \u003ccode\u003eDockerfile\u003c/code\u003e 内の変数として使える。\n使い方は、 \u003ccode\u003e$variable_name\u003c/code\u003e もしくは、 \u003ccode\u003e${variable_name}\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-Dockerfile\"\u003eFROM \u0026#x3C;image\u003e\nENV FOO=/bar\nWORKDIR ${FOO} # WORKDIR /bar\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eENTRYPOINT\u003c/h3\u003e\n\u003cp\u003e最適な使い方はイメージに対してメインのコマンドを設定しておき、 \u003ccode\u003eCMD\u003c/code\u003e を使ってデフォルトフラグを指定する。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-Dockerfile\"\u003eENTRYPOINT [\"go\"]\nCMD [\"--help\"]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eパラメータを指定して起動することでコマンドの実行ができる。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e$ docker run \u0026#x3C;image\u003e run main.go\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eVOLUME\u003c/h3\u003e\n\u003cp\u003eコンテナによって作成されるファイルやフォルダの公開に使う。イメージの可変的な部分、ユーザが設定可能な部分について使う。\u003c/p\u003e\n\u003ch3\u003eUSER\u003c/h3\u003e\n\u003cp\u003e非 root ユーザで実行可能な場合は \u003ccode\u003eUSER\u003c/code\u003e を使ってユーザの変更する。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-Dockerfile\"\u003eUSER \u0026#x3C;ユーザ\u003e[:\u0026#x3C;グループ\u003e]\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eWORKDIR\u003c/h3\u003e\n\u003cp\u003eDockerfile で続く \u003ccode\u003eRUN\u003c/code\u003e、 \u003ccode\u003eCMD\u003c/code\u003e、 \u003ccode\u003eENTRYPOINT\u003c/code\u003e、 \u003ccode\u003eCOPY / ADD\u003c/code\u003e の命令の処理時で使う作業ディレクトリを指定する。\u003c/p\u003e\n\u003ch3\u003eARG\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003ebuild\u003c/code\u003e 時にユーザが渡せる変数を定義する。\n構築時には \u003ccode\u003edocker build --build-arg \u0026#x3C;変数名\u003e=\u0026#x3C;値\u003e\u003c/code\u003e を指定する。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-Dockerfile\"\u003eARG \u0026#x3C;name\u003e[=\u0026#x3C;デフォルト値\u003e]\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003edocker-compose\u003c/h2\u003e\n\u003cp\u003eサービスを定義する。\u003c/p\u003e\n\u003ch3\u003ebuild\u003c/h3\u003e\n\u003cp\u003eビルド時に適用される。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yml\"\u003e\u003cspan class=\"hljs-attr\"\u003eservices:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ewebapp:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ebuild:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./dir\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003econtext\u003c/code\u003e でパスを指定し, \u003ccode\u003eDockerfile\u003c/code\u003e や \u003ccode\u003eargs\u003c/code\u003e も指定できる。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yml\"\u003e\u003cspan class=\"hljs-attr\"\u003eservices:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ewebapp:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ebuild:\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003econtext:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./dir\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003edockerfile:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eDockerfile-alternate\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003eargs:\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003ebuildno:\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eimage\u003c/code\u003e 名と \u003ccode\u003etag\u003c/code\u003e を指定できる。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yml\"\u003e\u003cspan class=\"hljs-attr\"\u003ebuild:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./dir\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eimage:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ewebapp:tag\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003econtext\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003eDockerfile\u003c/code\u003e を含むディレクトリへのパスか、 git リポジトリの URL を指定する。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yml\"\u003e\u003cspan class=\"hljs-attr\"\u003ebuild:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003econtext:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./dir\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003edockerfile\u003c/h3\u003e\n\u003cp\u003e別の \u003ccode\u003eDockerfile\u003c/code\u003e を指定する。この場合、ビルドパスを同時に指定する必要がある。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yml\"\u003e\u003cspan class=\"hljs-attr\"\u003ebuild:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003econtext:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e.\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003edockerfile:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eDockerfile-alternate\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eargs\u003c/h3\u003e\n\u003cp\u003eビルド時にのみ有効な環境変数を設定する。\n個々をマッピングするか、リストで書く.ブール値はクォートで囲む。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yml\"\u003e\u003cspan class=\"hljs-attr\"\u003ebuild:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003econtext:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e.\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eargs:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ebuildno:\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003egitcommithash:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eabc123\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yml\"\u003e\u003cspan class=\"hljs-attr\"\u003ebuild:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003econtext:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e.\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eargs:\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ebuildno=1\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egitcommithash=abc123\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003ecommand\u003c/h3\u003e\n\u003cp\u003eデフォルトのコマンドを上書きする。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yml\"\u003e\u003cspan class=\"hljs-attr\"\u003ecommand:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ebundle\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eexec\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ethin\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e-p\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eリスト形式も可能。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yml\"\u003e\u003cspan class=\"hljs-attr\"\u003ecommand:\u003c/span\u003e [\u003cspan class=\"hljs-string\"\u003e\"bundle\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"exec\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"thin\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"-p\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"3000\"\u003c/span\u003e]\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003edepends_on\u003c/h3\u003e\n\u003cp\u003eサービス起動の依存関係を表す。\n以下の場合、 db と redis の起動後に web が起動する。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yml\"\u003e\u003cspan class=\"hljs-attr\"\u003eversion:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"3.9\"\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eservices:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eweb:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ebuild:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e.\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003edepends_on:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edb\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eredis\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eredis:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eimage:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eredis\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003edb:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eimage:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epostgres\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eentrypoint\u003c/h3\u003e\n\u003cp\u003eデフォルトのエントリーポイントを上書きする。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yml\"\u003e\u003cspan class=\"hljs-attr\"\u003eentrypoint:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e/code/entrypoint.sh\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eリスト形式も可能。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yml\"\u003e\u003cspan class=\"hljs-attr\"\u003eentrypoint:\u003c/span\u003e [\u003cspan class=\"hljs-string\"\u003e\"php\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"-d\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"memry_limit=1\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"vendor/bin/phpunit\"\u003c/span\u003e]\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eenvironment\u003c/h3\u003e\n\u003cp\u003e環境変数を追加する。\n個々をマッピングするか,リストで書く.ブール値はクォートで囲む。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yml\"\u003e\u003cspan class=\"hljs-attr\"\u003eenvironment:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eRACK_ENV:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edevelopment\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eSHOW:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'true'\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eSESSION_SECRET:\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yml\"\u003e\u003cspan class=\"hljs-attr\"\u003eenvironment:\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eRACK_ENV=development\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eSHOW=true\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eSESSION_SECRET\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eexpose\u003c/h3\u003e\n\u003cp\u003eホストマシンにはポートを公開せずに,ポートを expose する.\nリンクされたサービスのみアクセス可能。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yml\"\u003e\u003cspan class=\"hljs-attr\"\u003eexpose:\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"3000\"\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"8000\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eexternal_links\u003c/h3\u003e\n\u003cp\u003e実行する \u003ccode\u003edocker-compose.yml\u003c/code\u003e 以外から起動されたコンテナをリンクする。\nコンテナ名とエイリアス名 (CONTAINER:ALIAS) を指定する。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yml\"\u003e\u003cspan class=\"hljs-attr\"\u003eexternal_links:\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eredis_1\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eproject_db_1:mysql\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eextra_hosts\u003c/h3\u003e\n\u003cp\u003eホスト名をマッピングに追加する。\n\u003ccode\u003e/etc/hosts\u003c/code\u003e に追加される。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yml\"\u003e\u003cspan class=\"hljs-attr\"\u003eextra_hosts:\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"somehost:162.242.195.82\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eports\u003c/h3\u003e\n\u003cp\u003e公開用のポートを設定する。\nホスト側とコンテナ側のポートを指定する( \u003ccode\u003eHOST:CONTAINER\u003c/code\u003e )。\nもしくは、コンテナ側のポートを指定する。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yml\"\u003e\u003cspan class=\"hljs-attr\"\u003eports:\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"3000\"\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"3000-3005\"\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"8000:8000\"\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"9090-9091:8080-8081\"\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"49100:22\"\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"127.0.0.1:8001:8001\"\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"127.0.0.1:5000-5010:5000-5010\"\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"6060:6060/udp\"\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"12400-12500:1240\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003evolumes\u003c/h3\u003e\n\u003cp\u003e複数のサービスにわたってボリュームを再利用したい場合、最上位の \u003ccode\u003evolumes\u003c/code\u003e キーで名前付きボリュームを定義する。\n以下の場合、 db サービスのデータディレクトリは、 backup サービスのボリュームにも共有させている。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yml\"\u003e\u003cspan class=\"hljs-attr\"\u003eversion:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"3.9\"\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eservices:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003edb:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eimage:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edb\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003evolumes:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edata-volume:/var/lib/db\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ebackup:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eimage:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ebackup-service\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003evolumes:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edata-volume:/var/lib/backup/data\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003evolumes:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003edata-volume:\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e短い書き方では、 \u003ccode\u003e[SOURCE:]TARGET[:MODE]\u003c/code\u003e と書ける。 \u003ccode\u003ero\u003c/code\u003e は \u003ccode\u003ereadonly\u003c/code\u003e 。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yml\"\u003e\u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./cache:/tmp/cache:ro\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e変数の置換\u003c/h3\u003e\n\u003cp\u003eシェル環境に \u003ccode\u003ePOSTGRES_VERSION=9.3\u003c/code\u003e が定義されていると、 postgres のバージョンは 9.3 になる。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yml\"\u003e\u003cspan class=\"hljs-attr\"\u003edb:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eimage:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"postgres:${POSTGRES_VERSION}\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e環境変数が設定されていない場合は空文字になる。\n環境変数のデフォルト値は \u003ccode\u003e.env\u003c/code\u003e ファイルに設定しておくことができる。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e${VARIABLE:-default} は VARIABLE がセットされていないか, 空文字のときに \u003ccode\u003edefault\u003c/code\u003e として評価される\u003c/li\u003e\n\u003cli\u003e${VARIABLE-default} は VARIABLE がセットされているときのみ \u003ccode\u003edefault\u003c/code\u003e として評価される\u003c/li\u003e\n\u003c/ul\u003e"])</script><script>self.__next_f.push([1,"5:[\"$\",\"article\",null,{\"style\":{\"maxWidth\":\"1000px\",\"margin\":\"0 auto\",\"padding\":\"0 2rem 2rem\"},\"children\":[[\"$\",\"h1\",null,{\"children\":\"Dockerとdocker-composeのまとめ\"}],[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$10\"}}]]}]\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n7:null\n"])</script><script>self.__next_f.push([1,"9:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"MyDocs\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"A simple SSG blog built with Next.js\"}]],\"error\":null,\"digest\":\"$undefined\"}\n"])</script><script>self.__next_f.push([1,"e:\"$9:metadata\"\n"])</script></body></html>