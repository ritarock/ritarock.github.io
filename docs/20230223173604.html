<!DOCTYPE html><!--Mc6Th0Rmyk9pcJ5CRitSL--><html lang="ja"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/chunks/5cd79379acc82b6b.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/b21aca2c9ac15a8a.js"/><script src="/_next/static/chunks/a9077698ef76e11f.js" async=""></script><script src="/_next/static/chunks/9111b5fcf0c978a5.js" async=""></script><script src="/_next/static/chunks/7e6ac27ac20c5ced.js" async=""></script><script src="/_next/static/chunks/turbopack-50d90477f30c1568.js" async=""></script><script src="/_next/static/chunks/1af1dd91bd03bb80.js" async=""></script><script src="/_next/static/chunks/cc5639b053815f24.js" async=""></script><script src="/_next/static/chunks/4904848246fadb45.js" async=""></script><title>MyDocs</title><meta name="description" content="A simple SSG blog built with Next.js"/><script src="/_next/static/chunks/a6dad97d9634a72d.js" noModule=""></script></head><body style="background-color:ghostwhite;margin:0;min-height:100vh"><div hidden=""><!--$--><!--/$--></div><header style="padding:1rem 0;margin-bottom:0.25rem"><div style="max-width:1000px;margin:0 auto;padding:0 2rem"><a style="font-size:1.5rem;font-weight:bold;text-decoration:none;color:#333" href="/">MyDocs</a></div></header><article style="max-width:1000px;margin:0 auto;padding:0 2rem 2rem"><h1>gqlgenを触る</h1><div><h2>database の準備</h2>
<pre><code class="hljs language-bash">$ go run -mod=mod entgo.io/ent/cmd/ent new Todo
</code></pre>
<p>schema の設定。</p>
<pre><code class="hljs language-go"><span class="hljs-comment">// Fields of the Todo.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(Todo)</span></span> Fields() []ent.Field {
	<span class="hljs-keyword">return</span> []ent.Field{
		field.String(<span class="hljs-string">"title"</span>),
		field.String(<span class="hljs-string">"note"</span>),
		field.Bool(<span class="hljs-string">"completed"</span>).Default(<span class="hljs-literal">false</span>),
		field.Time(<span class="hljs-string">"created_at"</span>).Default(time.Now()),
		field.Time(<span class="hljs-string">"updated_at"</span>).Default(time.Now()),
	}
}
</code></pre>
<pre><code class="hljs language-bash">$ go generate ./ent
</code></pre>
<h2>gqlgen</h2>
<pre><code class="hljs language-bash">$ <span class="hljs-built_in">printf</span> <span class="hljs-string">'// +build tools\npackage tools\nimport (_ "github.com/99designs/gqlgen"\n _ "github.com/99designs/gqlgen/graphql/introspection")'</span> | gofmt > tools.go
$ go mod tidy
$ go run github.com/99designs/gqlgen init

</code></pre>
<p><code>graph/</code> に生成されたファイル。</p>
<pre><code class="hljs language-bash">tree graph/
graph/
├── generated.go <span class="hljs-comment"># 自動生成</span>
├── model
│   └── models_gen.go <span class="hljs-comment"># 自動生成</span>
├── resolver.go
├── schema.graphqls
└── schema.resolvers.go
</code></pre>
<p>ファイルは <code>resolver.go</code>、<code>schema.graphqls</code>、<code>schema.resolvers.go</code> で良さそう。
プロジェクト直下に生成された <code>gqlgen.yml</code> は一旦放置。</p>
<h3>スキーマ定義</h3>
<p><code>schema.graphqls / schema.resolvers.go</code> を削除し、新規にスキーマ定義ファイルを作る。</p>
<p>共有インターフェイス Node を定義する。プライマリーキーを持つ場合は Node インターフェイスを作るのがお作法らしい。また、独自の型として Datetime を定義する。</p>
<pre><code class="hljs language-common.graphqls">interface Node {
    id: ID!
}

scalar Datetime
</code></pre>
<p>次に Todo スキーマを定義する。</p>
<pre><code class="hljs language-todo.graphqls">type Todo implements Node {
    id: ID!
    title: String!
    note: String!
    completed: Boolean!
    created_at: Datetime!
    updated_at: Datetime!
}
</code></pre>
<p>最後に query と mutation を定義する。</p>
<pre><code class="hljs language-query.graphqls">type Query {
    todos: [Todo!]!
}
</code></pre>
<pre><code class="hljs language-mutation.graphqls">type Mutation {
    createTodo(input: NewTodo!): Todo!
}

input NewTodo {
    id: ID
    title: String!
    note: String!
    completed: Boolean
    created_at: Datetime
    updated_at: Datetime
}
</code></pre>
<h3>コードの生成</h3>
<pre><code class="hljs language-bash">$ go run github.com/99designs/gqlgen
</code></pre>
<h3>実装</h3>
<p>resolver から参照できるようにフィールドを追加する。</p>
<pre><code class="hljs language-go"><span class="hljs-keyword">type</span> Resolver <span class="hljs-keyword">struct</span> {
	EntClient *ent.Client
}
</code></pre>
<p><code>query.resolvers.go</code> を実装する。</p>
<pre><code class="hljs language-go"><span class="hljs-comment">// Todos is the resolver for the todos field.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *queryResolver)</span></span> Todos(ctx context.Context) ([]*model.Todo, <span class="hljs-type">error</span>) {
	todos := []*model.Todo{}
	searched, _ := r.EntClient.Todo.Query().All(ctx)
	<span class="hljs-keyword">for</span> _, todo := <span class="hljs-keyword">range</span> searched {
		todos = <span class="hljs-built_in">append</span>(todos, &#x26;model.Todo{
			ID:        strconv.Itoa(todo.ID),
			Title:     todo.Title,
			Note:      todo.Note,
			Completed: todo.Completed,
			CreatedAt: todo.CreatedAt.String(),
			UpdatedAt: todo.UpdatedAt.String(),
		})
	}
	<span class="hljs-keyword">return</span> todos, <span class="hljs-literal">nil</span>
}
</code></pre>
<p><code>mutation.resolvers.go</code> を実装する。</p>
<pre><code class="hljs language-go"><span class="hljs-comment">// CreateTodo is the resolver for the createTodo field.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *mutationResolver)</span></span> CreateTodo(ctx context.Context, input model.NewTodo) (*model.Todo, <span class="hljs-type">error</span>) {
	created, _ := r.EntClient.Todo.Create().
		SetTitle(input.Title).
		SetNote(input.Note).
		Save(ctx)

	<span class="hljs-keyword">return</span> &#x26;model.Todo{
		ID:        strconv.Itoa(created.ID),
		Title:     created.Title,
		Note:      created.Note,
		Completed: created.Completed,
		CreatedAt: created.CreatedAt.String(),
		UpdatedAt: created.UpdatedAt.String(),
	}, <span class="hljs-literal">nil</span>
}
</code></pre>
<h2>server の実装</h2>
<p>最後は echo で実行できるようにする。<code>server.go</code> は不要なので削除。</p>
<pre><code class="hljs language-main.go">package main

import (
	"context"
	"gqlgen-todo/ent"
	"gqlgen-todo/graph"
	"net/http"

	"github.com/99designs/gqlgen/graphql/handler"
	"github.com/99designs/gqlgen/graphql/playground"
	"github.com/labstack/echo/v4"
	_ "github.com/mattn/go-sqlite3"
)

const (
	DRIVER      = "sqlite3"
	DATA_SOURCE = "file:ent?mode=memory&#x26;cache=shared&#x26;_fk=1"
)

func main() {
	ctx := context.Background()
	client, _ := ent.Open(DRIVER, DATA_SOURCE)
	client.Schema.Create(ctx)

	e := echo.New()
	e.GET("/health", func(c echo.Context) error {
		return c.String(http.StatusOK, "ok")
	})

	graphqlHandler := handler.NewDefaultServer(
		graph.NewExecutableSchema(
			graph.Config{
				Resolvers: &#x26;graph.Resolver{
					EntClient: client,
				},
			},
		),
	)
	playgroudHandler := playground.Handler("GraphQL", "/query")

	e.POST("/query", func(c echo.Context) error {
		graphqlHandler.ServeHTTP(c.Response(), c.Request())
		return nil
	})

	e.GET("playground", func(c echo.Context) error {
		playgroudHandler.ServeHTTP(c.Response(), c.Request())
		return nil
	})

	e.Logger.Fatal(e.Start(":8080"))
}
</code></pre>
<h3>試す</h3>
<pre><code class="hljs language-query">mutation {
  createTodo(input: {
    title: "title1",
    note: "note1"
  }) {
    id
    title
    note
    completed
    created_at
    updated_at
  }
}

{
  "data": {
    "createTodo": {
      "id": "1",
      "title": "title1",
      "note": "note1",
      "completed": false,
      "created_at": "2023-02-23 17:33:13",
      "updated_at": "2023-02-23 17:33:13"
    }
  }
}
</code></pre>
<pre><code class="hljs language-query">{
  todos {
    id
    title
    note
    completed
    created_at
    updated_at
  }
}

{
  "data": {
    "todos": [
      {
        "id": "1",
        "title": "title1",
        "note": "note1",
        "completed": false,
        "created_at": "2023-02-23 17:33:13",
        "updated_at": "2023-02-23 17:33:13"
      },
      {
        "id": "2",
        "title": "title2",
        "note": "note2",
        "completed": false,
        "created_at": "2023-02-23 17:33:13",
        "updated_at": "2023-02-23 17:33:13"
      },
      {
        "id": "3",
        "title": "title3",
        "note": "note3",
        "completed": false,
        "created_at": "2023-02-23 17:33:13",
        "updated_at": "2023-02-23 17:33:13"
      }
    ]
  }
}
</code></pre></div></article><!--$--><!--/$--><script src="/_next/static/chunks/b21aca2c9ac15a8a.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[70045,[\"/_next/static/chunks/1af1dd91bd03bb80.js\"],\"\"]\n3:I[56454,[\"/_next/static/chunks/cc5639b053815f24.js\",\"/_next/static/chunks/4904848246fadb45.js\"],\"default\"]\n4:I[10158,[\"/_next/static/chunks/cc5639b053815f24.js\",\"/_next/static/chunks/4904848246fadb45.js\"],\"default\"]\n6:I[25151,[\"/_next/static/chunks/cc5639b053815f24.js\",\"/_next/static/chunks/4904848246fadb45.js\"],\"OutletBoundary\"]\n7:\"$Sreact.suspense\"\n9:I[25151,[\"/_next/static/chunks/cc5639b053815f24.js\",\"/_next/static/chunks/4904848246fadb45.js\"],\"ViewportBoundary\"]\nb:I[25151,[\"/_next/static/chunks/cc5639b053815f24.js\",\"/_next/static/chunks/4904848246fadb45.js\"],\"MetadataBoundary\"]\nd:I[9442,[\"/_next/static/chunks/cc5639b053815f24.js\",\"/_next/static/chunks/4904848246fadb45.js\"],\"default\"]\n:HL[\"/_next/static/chunks/5cd79379acc82b6b.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"Mc6Th0Rmyk9pcJ5CRitSL\",\"c\":[\"\",\"docs\",\"20230223173604\"],\"q\":\"\",\"i\":false,\"f\":[[[\"\",{\"children\":[\"docs\",{\"children\":[[\"slug\",\"20230223173604\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/chunks/5cd79379acc82b6b.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/1af1dd91bd03bb80.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"ja\",\"children\":[\"$\",\"body\",null,{\"style\":{\"backgroundColor\":\"ghostwhite\",\"margin\":0,\"minHeight\":\"100vh\"},\"children\":[[\"$\",\"header\",null,{\"style\":{\"padding\":\"1rem 0\",\"marginBottom\":\"0.25rem\"},\"children\":[\"$\",\"div\",null,{\"style\":{\"maxWidth\":\"1000px\",\"margin\":\"0 auto\",\"padding\":\"0 2rem\"},\"children\":[\"$\",\"$L2\",null,{\"href\":\"/\",\"style\":{\"fontSize\":\"1.5rem\",\"fontWeight\":\"bold\",\"textDecoration\":\"none\",\"color\":\"#333\"},\"children\":\"MyDocs\"}]}]}],[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}]}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",null,[\"$\",\"$L6\",null,{\"children\":[\"$\",\"$7\",null,{\"name\":\"Next.MetadataOutlet\",\"children\":\"$@8\"}]}]]}],{},null,false,false]},null,false,false]},null,false,false]},null,false,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$L9\",null,{\"children\":\"$@a\"}],[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$Lb\",null,{\"children\":[\"$\",\"$7\",null,{\"name\":\"Next.Metadata\",\"children\":\"$@c\"}]}]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$d\",[]],\"S\":true}\n"])</script><script>self.__next_f.push([1,"e:T1e38,"])</script><script>self.__next_f.push([1,"\u003ch2\u003edatabase の準備\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e$ go run -mod=mod entgo.io/ent/cmd/ent new Todo\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eschema の設定。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003e\u003cspan class=\"hljs-comment\"\u003e// Fields of the Todo.\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(Todo)\u003c/span\u003e\u003c/span\u003e Fields() []ent.Field {\n\t\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e []ent.Field{\n\t\tfield.String(\u003cspan class=\"hljs-string\"\u003e\"title\"\u003c/span\u003e),\n\t\tfield.String(\u003cspan class=\"hljs-string\"\u003e\"note\"\u003c/span\u003e),\n\t\tfield.Bool(\u003cspan class=\"hljs-string\"\u003e\"completed\"\u003c/span\u003e).Default(\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e),\n\t\tfield.Time(\u003cspan class=\"hljs-string\"\u003e\"created_at\"\u003c/span\u003e).Default(time.Now()),\n\t\tfield.Time(\u003cspan class=\"hljs-string\"\u003e\"updated_at\"\u003c/span\u003e).Default(time.Now()),\n\t}\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e$ go generate ./ent\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003egqlgen\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e$ \u003cspan class=\"hljs-built_in\"\u003eprintf\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'// +build tools\\npackage tools\\nimport (_ \"github.com/99designs/gqlgen\"\\n _ \"github.com/99designs/gqlgen/graphql/introspection\")'\u003c/span\u003e | gofmt \u003e tools.go\n$ go mod tidy\n$ go run github.com/99designs/gqlgen init\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003egraph/\u003c/code\u003e に生成されたファイル。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003etree graph/\ngraph/\n├── generated.go \u003cspan class=\"hljs-comment\"\u003e# 自動生成\u003c/span\u003e\n├── model\n│   └── models_gen.go \u003cspan class=\"hljs-comment\"\u003e# 自動生成\u003c/span\u003e\n├── resolver.go\n├── schema.graphqls\n└── schema.resolvers.go\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eファイルは \u003ccode\u003eresolver.go\u003c/code\u003e、\u003ccode\u003eschema.graphqls\u003c/code\u003e、\u003ccode\u003eschema.resolvers.go\u003c/code\u003e で良さそう。\nプロジェクト直下に生成された \u003ccode\u003egqlgen.yml\u003c/code\u003e は一旦放置。\u003c/p\u003e\n\u003ch3\u003eスキーマ定義\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003eschema.graphqls / schema.resolvers.go\u003c/code\u003e を削除し、新規にスキーマ定義ファイルを作る。\u003c/p\u003e\n\u003cp\u003e共有インターフェイス Node を定義する。プライマリーキーを持つ場合は Node インターフェイスを作るのがお作法らしい。また、独自の型として Datetime を定義する。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-common.graphqls\"\u003einterface Node {\n    id: ID!\n}\n\nscalar Datetime\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e次に Todo スキーマを定義する。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-todo.graphqls\"\u003etype Todo implements Node {\n    id: ID!\n    title: String!\n    note: String!\n    completed: Boolean!\n    created_at: Datetime!\n    updated_at: Datetime!\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e最後に query と mutation を定義する。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-query.graphqls\"\u003etype Query {\n    todos: [Todo!]!\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-mutation.graphqls\"\u003etype Mutation {\n    createTodo(input: NewTodo!): Todo!\n}\n\ninput NewTodo {\n    id: ID\n    title: String!\n    note: String!\n    completed: Boolean\n    created_at: Datetime\n    updated_at: Datetime\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eコードの生成\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e$ go run github.com/99designs/gqlgen\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e実装\u003c/h3\u003e\n\u003cp\u003eresolver から参照できるようにフィールドを追加する。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003e\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e Resolver \u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e {\n\tEntClient *ent.Client\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003equery.resolvers.go\u003c/code\u003e を実装する。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003e\u003cspan class=\"hljs-comment\"\u003e// Todos is the resolver for the todos field.\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(r *queryResolver)\u003c/span\u003e\u003c/span\u003e Todos(ctx context.Context) ([]*model.Todo, \u003cspan class=\"hljs-type\"\u003eerror\u003c/span\u003e) {\n\ttodos := []*model.Todo{}\n\tsearched, _ := r.EntClient.Todo.Query().All(ctx)\n\t\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e _, todo := \u003cspan class=\"hljs-keyword\"\u003erange\u003c/span\u003e searched {\n\t\ttodos = \u003cspan class=\"hljs-built_in\"\u003eappend\u003c/span\u003e(todos, \u0026#x26;model.Todo{\n\t\t\tID:        strconv.Itoa(todo.ID),\n\t\t\tTitle:     todo.Title,\n\t\t\tNote:      todo.Note,\n\t\t\tCompleted: todo.Completed,\n\t\t\tCreatedAt: todo.CreatedAt.String(),\n\t\t\tUpdatedAt: todo.UpdatedAt.String(),\n\t\t})\n\t}\n\t\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e todos, \u003cspan class=\"hljs-literal\"\u003enil\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003emutation.resolvers.go\u003c/code\u003e を実装する。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-go\"\u003e\u003cspan class=\"hljs-comment\"\u003e// CreateTodo is the resolver for the createTodo field.\u003c/span\u003e\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunc\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(r *mutationResolver)\u003c/span\u003e\u003c/span\u003e CreateTodo(ctx context.Context, input model.NewTodo) (*model.Todo, \u003cspan class=\"hljs-type\"\u003eerror\u003c/span\u003e) {\n\tcreated, _ := r.EntClient.Todo.Create().\n\t\tSetTitle(input.Title).\n\t\tSetNote(input.Note).\n\t\tSave(ctx)\n\n\t\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u0026#x26;model.Todo{\n\t\tID:        strconv.Itoa(created.ID),\n\t\tTitle:     created.Title,\n\t\tNote:      created.Note,\n\t\tCompleted: created.Completed,\n\t\tCreatedAt: created.CreatedAt.String(),\n\t\tUpdatedAt: created.UpdatedAt.String(),\n\t}, \u003cspan class=\"hljs-literal\"\u003enil\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eserver の実装\u003c/h2\u003e\n\u003cp\u003e最後は echo で実行できるようにする。\u003ccode\u003eserver.go\u003c/code\u003e は不要なので削除。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-main.go\"\u003epackage main\n\nimport (\n\t\"context\"\n\t\"gqlgen-todo/ent\"\n\t\"gqlgen-todo/graph\"\n\t\"net/http\"\n\n\t\"github.com/99designs/gqlgen/graphql/handler\"\n\t\"github.com/99designs/gqlgen/graphql/playground\"\n\t\"github.com/labstack/echo/v4\"\n\t_ \"github.com/mattn/go-sqlite3\"\n)\n\nconst (\n\tDRIVER      = \"sqlite3\"\n\tDATA_SOURCE = \"file:ent?mode=memory\u0026#x26;cache=shared\u0026#x26;_fk=1\"\n)\n\nfunc main() {\n\tctx := context.Background()\n\tclient, _ := ent.Open(DRIVER, DATA_SOURCE)\n\tclient.Schema.Create(ctx)\n\n\te := echo.New()\n\te.GET(\"/health\", func(c echo.Context) error {\n\t\treturn c.String(http.StatusOK, \"ok\")\n\t})\n\n\tgraphqlHandler := handler.NewDefaultServer(\n\t\tgraph.NewExecutableSchema(\n\t\t\tgraph.Config{\n\t\t\t\tResolvers: \u0026#x26;graph.Resolver{\n\t\t\t\t\tEntClient: client,\n\t\t\t\t},\n\t\t\t},\n\t\t),\n\t)\n\tplaygroudHandler := playground.Handler(\"GraphQL\", \"/query\")\n\n\te.POST(\"/query\", func(c echo.Context) error {\n\t\tgraphqlHandler.ServeHTTP(c.Response(), c.Request())\n\t\treturn nil\n\t})\n\n\te.GET(\"playground\", func(c echo.Context) error {\n\t\tplaygroudHandler.ServeHTTP(c.Response(), c.Request())\n\t\treturn nil\n\t})\n\n\te.Logger.Fatal(e.Start(\":8080\"))\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e試す\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-query\"\u003emutation {\n  createTodo(input: {\n    title: \"title1\",\n    note: \"note1\"\n  }) {\n    id\n    title\n    note\n    completed\n    created_at\n    updated_at\n  }\n}\n\n{\n  \"data\": {\n    \"createTodo\": {\n      \"id\": \"1\",\n      \"title\": \"title1\",\n      \"note\": \"note1\",\n      \"completed\": false,\n      \"created_at\": \"2023-02-23 17:33:13\",\n      \"updated_at\": \"2023-02-23 17:33:13\"\n    }\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-query\"\u003e{\n  todos {\n    id\n    title\n    note\n    completed\n    created_at\n    updated_at\n  }\n}\n\n{\n  \"data\": {\n    \"todos\": [\n      {\n        \"id\": \"1\",\n        \"title\": \"title1\",\n        \"note\": \"note1\",\n        \"completed\": false,\n        \"created_at\": \"2023-02-23 17:33:13\",\n        \"updated_at\": \"2023-02-23 17:33:13\"\n      },\n      {\n        \"id\": \"2\",\n        \"title\": \"title2\",\n        \"note\": \"note2\",\n        \"completed\": false,\n        \"created_at\": \"2023-02-23 17:33:13\",\n        \"updated_at\": \"2023-02-23 17:33:13\"\n      },\n      {\n        \"id\": \"3\",\n        \"title\": \"title3\",\n        \"note\": \"note3\",\n        \"completed\": false,\n        \"created_at\": \"2023-02-23 17:33:13\",\n        \"updated_at\": \"2023-02-23 17:33:13\"\n      }\n    ]\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"5:[\"$\",\"article\",null,{\"style\":{\"maxWidth\":\"1000px\",\"margin\":\"0 auto\",\"padding\":\"0 2rem 2rem\"},\"children\":[[\"$\",\"h1\",null,{\"children\":\"gqlgenを触る\"}],[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$e\"}}]]}]\n"])</script><script>self.__next_f.push([1,"a:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"title\",\"0\",{\"children\":\"MyDocs\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"A simple SSG blog built with Next.js\"}]]\n8:null\n"])</script></body></html>